(function(C,V){typeof exports=="object"&&typeof module<"u"?module.exports=V(require("react"),require("react-dom")):typeof define=="function"&&define.amd?define(["react","react-dom"],V):(C=typeof globalThis<"u"?globalThis:C||self,C.VoiceAssistantWidget=V(C.React,C.ReactDOM))})(this,function(C,V){"use strict";var cd=Object.defineProperty;var bo=C=>{throw TypeError(C)};var ud=(C,V,se)=>V in C?cd(C,V,{enumerable:!0,configurable:!0,writable:!0,value:se}):C[V]=se;var F=(C,V,se)=>ud(C,typeof V!="symbol"?V+"":V,se),dd=(C,V,se)=>V.has(C)||bo("Cannot "+se);var yo=(C,V,se)=>V.has(C)?bo("Cannot add the same private member more than once"):V instanceof WeakSet?V.add(C):V.set(C,se);var Vt=(C,V,se)=>(dd(C,V,"access private method"),se);var Ne,Wr,wo;function se(n){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(n){for(const t in n)if(t!=="default"){const r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:()=>n[t]})}}return e.default=n,Object.freeze(e)}const p=se(C),ko=se(V);var le=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xo(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function So(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var Hr={exports:{}},ft={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Eo=C,Co=Symbol.for("react.element"),To=Symbol.for("react.fragment"),Ao=Object.prototype.hasOwnProperty,Po=Eo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$o={key:!0,ref:!0,__self:!0,__source:!0};function Vr(n,e,t){var r,s={},o=null,i=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(i=e.ref);for(r in e)Ao.call(e,r)&&!$o.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:Co,type:n,key:o,ref:i,props:s,_owner:Po.current}}ft.Fragment=To,ft.jsx=Vr,ft.jsxs=Vr,Hr.exports=ft;var m=Hr.exports,Gr,Jr=V;Gr=Jr.createRoot,Jr.hydrateRoot;function Q(n,e,{checkForDefaultPrevented:t=!0}={}){return function(s){if(n==null||n(s),t===!1||!s.defaultPrevented)return e==null?void 0:e(s)}}function jo(n,e){typeof n=="function"?n(e):n!=null&&(n.current=e)}function Kr(...n){return e=>n.forEach(t=>jo(t,e))}function oe(...n){return p.useCallback(Kr(...n),n)}function Ro(n,e){const t=p.createContext(e),r=o=>{const{children:i,...a}=o,l=p.useMemo(()=>a,Object.values(a));return m.jsx(t.Provider,{value:l,children:i})};r.displayName=n+"Provider";function s(o){const i=p.useContext(t);if(i)return i;if(e!==void 0)return e;throw new Error(`\`${o}\` must be used within \`${n}\``)}return[r,s]}function Yr(n,e=[]){let t=[];function r(o,i){const a=p.createContext(i),l=t.length;t=[...t,i];const c=h=>{var S;const{scope:d,children:f,...v}=h,g=((S=d==null?void 0:d[n])==null?void 0:S[l])||a,y=p.useMemo(()=>v,Object.values(v));return m.jsx(g.Provider,{value:y,children:f})};c.displayName=o+"Provider";function u(h,d){var g;const f=((g=d==null?void 0:d[n])==null?void 0:g[l])||a,v=p.useContext(f);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${h}\` must be used within \`${o}\``)}return[c,u]}const s=()=>{const o=t.map(i=>p.createContext(i));return function(a){const l=(a==null?void 0:a[n])||o;return p.useMemo(()=>({[`__scope${n}`]:{...a,[n]:l}}),[a,l])}};return s.scopeName=n,[r,Oo(s,...e)]}function Oo(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(o){const i=r.reduce((a,{useScope:l,scopeName:c})=>{const h=l(o)[`__scope${c}`];return{...a,...h}},{});return p.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return t.scopeName=e.scopeName,t}var et=globalThis!=null&&globalThis.document?p.useLayoutEffect:()=>{},Io=p.useId||(()=>{}),Lo=0;function Gt(n){const[e,t]=p.useState(Io());return et(()=>{n||t(r=>r??String(Lo++))},[n]),n||(e?`radix-${e}`:"")}function ee(n){const e=p.useRef(n);return p.useEffect(()=>{e.current=n}),p.useMemo(()=>(...t)=>{var r;return(r=e.current)==null?void 0:r.call(e,...t)},[])}function Do({prop:n,defaultProp:e,onChange:t=()=>{}}){const[r,s]=No({defaultProp:e,onChange:t}),o=n!==void 0,i=o?n:r,a=ee(t),l=p.useCallback(c=>{if(o){const h=typeof c=="function"?c(n):c;h!==n&&a(h)}else s(c)},[o,n,s,a]);return[i,l]}function No({defaultProp:n,onChange:e}){const t=p.useState(n),[r]=t,s=p.useRef(r),o=ee(e);return p.useEffect(()=>{s.current!==r&&(o(r),s.current=r)},[r,s,o]),t}var Jt=p.forwardRef((n,e)=>{const{children:t,...r}=n,s=p.Children.toArray(t),o=s.find(Uo);if(o){const i=o.props.children,a=s.map(l=>l===o?p.Children.count(i)>1?p.Children.only(null):p.isValidElement(i)?i.props.children:null:l);return m.jsx(Kt,{...r,ref:e,children:p.isValidElement(i)?p.cloneElement(i,void 0,a):null})}return m.jsx(Kt,{...r,ref:e,children:t})});Jt.displayName="Slot";var Kt=p.forwardRef((n,e)=>{const{children:t,...r}=n;if(p.isValidElement(t)){const s=Fo(t);return p.cloneElement(t,{...zo(r,t.props),ref:e?Kr(e,s):s})}return p.Children.count(t)>1?p.Children.only(null):null});Kt.displayName="SlotClone";var Mo=({children:n})=>m.jsx(m.Fragment,{children:n});function Uo(n){return p.isValidElement(n)&&n.type===Mo}function zo(n,e){const t={...e};for(const r in e){const s=n[r],o=e[r];/^on[A-Z]/.test(r)?s&&o?t[r]=(...a)=>{o(...a),s(...a)}:s&&(t[r]=s):r==="style"?t[r]={...s,...o}:r==="className"&&(t[r]=[s,o].filter(Boolean).join(" "))}return{...n,...t}}function Fo(n){var r,s;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(s=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var Bo=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],te=Bo.reduce((n,e)=>{const t=p.forwardRef((r,s)=>{const{asChild:o,...i}=r,a=o?Jt:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),m.jsx(a,{...i,ref:s})});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{});function qo(n,e){n&&ko.flushSync(()=>n.dispatchEvent(e))}function Wo(n,e=globalThis==null?void 0:globalThis.document){const t=ee(n);p.useEffect(()=>{const r=s=>{s.key==="Escape"&&t(s)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[t,e])}var Ho="DismissableLayer",Yt="dismissableLayer.update",Vo="dismissableLayer.pointerDownOutside",Go="dismissableLayer.focusOutside",Xr,Zr=p.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Qr=p.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:r,onPointerDownOutside:s,onFocusOutside:o,onInteractOutside:i,onDismiss:a,...l}=n,c=p.useContext(Zr),[u,h]=p.useState(null),d=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=p.useState({}),v=oe(e,$=>h($)),g=Array.from(c.layers),[y]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),S=g.indexOf(y),b=u?g.indexOf(u):-1,_=c.layersWithOutsidePointerEventsDisabled.size>0,k=b>=S,E=Yo($=>{const O=$.target,P=[...c.branches].some(U=>U.contains(O));!k||P||(s==null||s($),i==null||i($),$.defaultPrevented||a==null||a())},d),A=Xo($=>{const O=$.target;[...c.branches].some(U=>U.contains(O))||(o==null||o($),i==null||i($),$.defaultPrevented||a==null||a())},d);return Wo($=>{b===c.layers.size-1&&(r==null||r($),!$.defaultPrevented&&a&&($.preventDefault(),a()))},d),p.useEffect(()=>{if(u)return t&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(Xr=d.body.style.pointerEvents,d.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),en(),()=>{t&&c.layersWithOutsidePointerEventsDisabled.size===1&&(d.body.style.pointerEvents=Xr)}},[u,d,t,c]),p.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),en())},[u,c]),p.useEffect(()=>{const $=()=>f({});return document.addEventListener(Yt,$),()=>document.removeEventListener(Yt,$)},[]),m.jsx(te.div,{...l,ref:v,style:{pointerEvents:_?k?"auto":"none":void 0,...n.style},onFocusCapture:Q(n.onFocusCapture,A.onFocusCapture),onBlurCapture:Q(n.onBlurCapture,A.onBlurCapture),onPointerDownCapture:Q(n.onPointerDownCapture,E.onPointerDownCapture)})});Qr.displayName=Ho;var Jo="DismissableLayerBranch",Ko=p.forwardRef((n,e)=>{const t=p.useContext(Zr),r=p.useRef(null),s=oe(e,r);return p.useEffect(()=>{const o=r.current;if(o)return t.branches.add(o),()=>{t.branches.delete(o)}},[t.branches]),m.jsx(te.div,{...n,ref:s})});Ko.displayName=Jo;function Yo(n,e=globalThis==null?void 0:globalThis.document){const t=ee(n),r=p.useRef(!1),s=p.useRef(()=>{});return p.useEffect(()=>{const o=a=>{if(a.target&&!r.current){let l=function(){tn(Vo,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=l,e.addEventListener("click",s.current,{once:!0})):l()}else e.removeEventListener("click",s.current);r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",o),e.removeEventListener("click",s.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function Xo(n,e=globalThis==null?void 0:globalThis.document){const t=ee(n),r=p.useRef(!1);return p.useEffect(()=>{const s=o=>{o.target&&!r.current&&tn(Go,t,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function en(){const n=new CustomEvent(Yt);document.dispatchEvent(n)}function tn(n,e,t,{discrete:r}){const s=t.originalEvent.target,o=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&s.addEventListener(n,e,{once:!0}),r?qo(s,o):s.dispatchEvent(o)}var Xt="focusScope.autoFocusOnMount",Zt="focusScope.autoFocusOnUnmount",rn={bubbles:!1,cancelable:!0},Zo="FocusScope",nn=p.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:s,onUnmountAutoFocus:o,...i}=n,[a,l]=p.useState(null),c=ee(s),u=ee(o),h=p.useRef(null),d=oe(e,g=>l(g)),f=p.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;p.useEffect(()=>{if(r){let g=function(_){if(f.paused||!a)return;const k=_.target;a.contains(k)?h.current=k:we(h.current,{select:!0})},y=function(_){if(f.paused||!a)return;const k=_.relatedTarget;k!==null&&(a.contains(k)||we(h.current,{select:!0}))},S=function(_){if(document.activeElement===document.body)for(const E of _)E.removedNodes.length>0&&we(a)};document.addEventListener("focusin",g),document.addEventListener("focusout",y);const b=new MutationObserver(S);return a&&b.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",y),b.disconnect()}}},[r,a,f.paused]),p.useEffect(()=>{if(a){an.add(f);const g=document.activeElement;if(!a.contains(g)){const S=new CustomEvent(Xt,rn);a.addEventListener(Xt,c),a.dispatchEvent(S),S.defaultPrevented||(Qo(si(sn(a)),{select:!0}),document.activeElement===g&&we(a))}return()=>{a.removeEventListener(Xt,c),setTimeout(()=>{const S=new CustomEvent(Zt,rn);a.addEventListener(Zt,u),a.dispatchEvent(S),S.defaultPrevented||we(g??document.body,{select:!0}),a.removeEventListener(Zt,u),an.remove(f)},0)}}},[a,c,u,f]);const v=p.useCallback(g=>{if(!t&&!r||f.paused)return;const y=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,S=document.activeElement;if(y&&S){const b=g.currentTarget,[_,k]=ei(b);_&&k?!g.shiftKey&&S===k?(g.preventDefault(),t&&we(_,{select:!0})):g.shiftKey&&S===_&&(g.preventDefault(),t&&we(k,{select:!0})):S===b&&g.preventDefault()}},[t,r,f.paused]);return m.jsx(te.div,{tabIndex:-1,...i,ref:d,onKeyDown:v})});nn.displayName=Zo;function Qo(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(we(r,{select:e}),document.activeElement!==t)return}function ei(n){const e=sn(n),t=on(e,n),r=on(e.reverse(),n);return[t,r]}function sn(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const s=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||s?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function on(n,e){for(const t of n)if(!ti(t,{upTo:e}))return t}function ti(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function ri(n){return n instanceof HTMLInputElement&&"select"in n}function we(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&ri(n)&&e&&n.select()}}var an=ni();function ni(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=ln(n,e),n.unshift(e)},remove(e){var t;n=ln(n,e),(t=n[0])==null||t.resume()}}}function ln(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function si(n){return n.filter(e=>e.tagName!=="A")}var oi="Portal",cn=p.forwardRef((n,e)=>{var a;const{container:t,...r}=n,[s,o]=p.useState(!1);et(()=>o(!0),[]);const i=t||s&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return i?V.createPortal(m.jsx(te.div,{...r,ref:e}),i):null});cn.displayName=oi;function ii(n,e){return p.useReducer((t,r)=>e[t][r]??t,n)}var _e=n=>{const{present:e,children:t}=n,r=ai(e),s=typeof t=="function"?t({present:r.isPresent}):p.Children.only(t),o=oe(r.ref,li(s));return typeof t=="function"||r.isPresent?p.cloneElement(s,{ref:o}):null};_e.displayName="Presence";function ai(n){const[e,t]=p.useState(),r=p.useRef({}),s=p.useRef(n),o=p.useRef("none"),i=n?"mounted":"unmounted",[a,l]=ii(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return p.useEffect(()=>{const c=pt(r.current);o.current=a==="mounted"?c:"none"},[a]),et(()=>{const c=r.current,u=s.current;if(u!==n){const d=o.current,f=pt(c);n?l("MOUNT"):f==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&d!==f?"ANIMATION_OUT":"UNMOUNT"),s.current=n}},[n,l]),et(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,h=f=>{const g=pt(r.current).includes(f.animationName);if(f.target===e&&g&&(l("ANIMATION_END"),!s.current)){const y=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=y)})}},d=f=>{f.target===e&&(o.current=pt(r.current))};return e.addEventListener("animationstart",d),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",d),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:p.useCallback(c=>{c&&(r.current=getComputedStyle(c)),t(c)},[])}}function pt(n){return(n==null?void 0:n.animationName)||"none"}function li(n){var r,s;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(s=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var Qt=0;function ci(){p.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??un()),document.body.insertAdjacentElement("beforeend",n[1]??un()),Qt++,()=>{Qt===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Qt--}},[])}function un(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.outline="none",n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",n}var fe=function(){return fe=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},fe.apply(this,arguments)};function dn(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function ui(n,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,o;r<s;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var gt="right-scroll-bar-position",mt="width-before-scroll-bar",di="with-scroll-bars-hidden",hi="--removed-body-scroll-bar-size";function er(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function fi(n,e){var t=C.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var s=t.value;s!==r&&(t.value=r,t.callback(r,s))}}}})[0];return t.callback=e,t.facade}var pi=typeof window<"u"?p.useLayoutEffect:p.useEffect,hn=new WeakMap;function gi(n,e){var t=fi(null,function(r){return n.forEach(function(s){return er(s,r)})});return pi(function(){var r=hn.get(t);if(r){var s=new Set(r),o=new Set(n),i=t.current;s.forEach(function(a){o.has(a)||er(a,null)}),o.forEach(function(a){s.has(a)||er(a,i)})}hn.set(t,n)},[n]),t}function mi(n){return n}function vi(n,e){e===void 0&&(e=mi);var t=[],r=!1,s={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(o){var i=e(o,r);return t.push(i),function(){t=t.filter(function(a){return a!==i})}},assignSyncMedium:function(o){for(r=!0;t.length;){var i=t;t=[],i.forEach(o)}t={push:function(a){return o(a)},filter:function(){return t}}},assignMedium:function(o){r=!0;var i=[];if(t.length){var a=t;t=[],a.forEach(o),i=t}var l=function(){var u=i;i=[],u.forEach(o)},c=function(){return Promise.resolve().then(l)};c(),t={push:function(u){i.push(u),c()},filter:function(u){return i=i.filter(u),t}}}};return s}function bi(n){n===void 0&&(n={});var e=vi(null);return e.options=fe({async:!0,ssr:!1},n),e}var fn=function(n){var e=n.sideCar,t=dn(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return p.createElement(r,fe({},t))};fn.isSideCarExport=!0;function yi(n,e){return n.useMedium(e),fn}var pn=bi(),tr=function(){},vt=p.forwardRef(function(n,e){var t=p.useRef(null),r=p.useState({onScrollCapture:tr,onWheelCapture:tr,onTouchMoveCapture:tr}),s=r[0],o=r[1],i=n.forwardProps,a=n.children,l=n.className,c=n.removeScrollBar,u=n.enabled,h=n.shards,d=n.sideCar,f=n.noIsolation,v=n.inert,g=n.allowPinchZoom,y=n.as,S=y===void 0?"div":y,b=n.gapMode,_=dn(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),k=d,E=gi([t,e]),A=fe(fe({},_),s);return p.createElement(p.Fragment,null,u&&p.createElement(k,{sideCar:pn,removeScrollBar:c,shards:h,noIsolation:f,inert:v,setCallbacks:o,allowPinchZoom:!!g,lockRef:t,gapMode:b}),i?p.cloneElement(p.Children.only(a),fe(fe({},A),{ref:E})):p.createElement(S,fe({},A,{className:l,ref:E}),a))});vt.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},vt.classNames={fullWidth:mt,zeroRight:gt};var wi=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function _i(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=wi();return e&&n.setAttribute("nonce",e),n}function ki(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function xi(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var Si=function(){var n=0,e=null;return{add:function(t){n==0&&(e=_i())&&(ki(e,t),xi(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Ei=function(){var n=Si();return function(e,t){p.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},gn=function(){var n=Ei(),e=function(t){var r=t.styles,s=t.dynamic;return n(r,s),null};return e},Ci={left:0,top:0,right:0,gap:0},rr=function(n){return parseInt(n||"",10)||0},Ti=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],s=e[n==="padding"?"paddingRight":"marginRight"];return[rr(t),rr(r),rr(s)]},Ai=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return Ci;var e=Ti(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},Pi=gn(),Me="data-scroll-locked",$i=function(n,e,t,r){var s=n.left,o=n.top,i=n.right,a=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(di,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(Me,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(gt,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(mt,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(gt," .").concat(gt,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(mt," .").concat(mt,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(Me,`] {
    `).concat(hi,": ").concat(a,`px;
  }
`)},mn=function(){var n=parseInt(document.body.getAttribute(Me)||"0",10);return isFinite(n)?n:0},ji=function(){p.useEffect(function(){return document.body.setAttribute(Me,(mn()+1).toString()),function(){var n=mn()-1;n<=0?document.body.removeAttribute(Me):document.body.setAttribute(Me,n.toString())}},[])},Ri=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,s=r===void 0?"margin":r;ji();var o=p.useMemo(function(){return Ai(s)},[s]);return p.createElement(Pi,{styles:$i(o,!e,s,t?"":"!important")})},nr=!1;if(typeof window<"u")try{var bt=Object.defineProperty({},"passive",{get:function(){return nr=!0,!0}});window.addEventListener("test",bt,bt),window.removeEventListener("test",bt,bt)}catch{nr=!1}var Ue=nr?{passive:!1}:!1,Oi=function(n){return n.tagName==="TEXTAREA"},vn=function(n,e){if(!(n instanceof Element))return!1;var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!Oi(n)&&t[e]==="visible")},Ii=function(n){return vn(n,"overflowY")},Li=function(n){return vn(n,"overflowX")},bn=function(n,e){var t=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var s=yn(n,r);if(s){var o=wn(n,r),i=o[1],a=o[2];if(i>a)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},Di=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},Ni=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},yn=function(n,e){return n==="v"?Ii(e):Li(e)},wn=function(n,e){return n==="v"?Di(e):Ni(e)},Mi=function(n,e){return n==="h"&&e==="rtl"?-1:1},Ui=function(n,e,t,r,s){var o=Mi(n,window.getComputedStyle(e).direction),i=o*r,a=t.target,l=e.contains(a),c=!1,u=i>0,h=0,d=0;do{var f=wn(n,a),v=f[0],g=f[1],y=f[2],S=g-y-o*v;(v||S)&&yn(n,a)&&(h+=S,d+=v),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&(Math.abs(h)<1||!s)||!u&&(Math.abs(d)<1||!s))&&(c=!0),c},yt=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},_n=function(n){return[n.deltaX,n.deltaY]},kn=function(n){return n&&"current"in n?n.current:n},zi=function(n,e){return n[0]===e[0]&&n[1]===e[1]},Fi=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},Bi=0,ze=[];function qi(n){var e=p.useRef([]),t=p.useRef([0,0]),r=p.useRef(),s=p.useState(Bi++)[0],o=p.useState(gn)[0],i=p.useRef(n);p.useEffect(function(){i.current=n},[n]),p.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(s));var g=ui([n.lockRef.current],(n.shards||[]).map(kn),!0).filter(Boolean);return g.forEach(function(y){return y.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),g.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(s))})}}},[n.inert,n.lockRef.current,n.shards]);var a=p.useCallback(function(g,y){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!i.current.allowPinchZoom;var S=yt(g),b=t.current,_="deltaX"in g?g.deltaX:b[0]-S[0],k="deltaY"in g?g.deltaY:b[1]-S[1],E,A=g.target,$=Math.abs(_)>Math.abs(k)?"h":"v";if("touches"in g&&$==="h"&&A.type==="range")return!1;var O=bn($,A);if(!O)return!0;if(O?E=$:(E=$==="v"?"h":"v",O=bn($,A)),!O)return!1;if(!r.current&&"changedTouches"in g&&(_||k)&&(r.current=E),!E)return!0;var P=r.current||E;return Ui(P,y,g,P==="h"?_:k,!0)},[]),l=p.useCallback(function(g){var y=g;if(!(!ze.length||ze[ze.length-1]!==o)){var S="deltaY"in y?_n(y):yt(y),b=e.current.filter(function(E){return E.name===y.type&&(E.target===y.target||y.target===E.shadowParent)&&zi(E.delta,S)})[0];if(b&&b.should){y.cancelable&&y.preventDefault();return}if(!b){var _=(i.current.shards||[]).map(kn).filter(Boolean).filter(function(E){return E.contains(y.target)}),k=_.length>0?a(y,_[0]):!i.current.noIsolation;k&&y.cancelable&&y.preventDefault()}}},[]),c=p.useCallback(function(g,y,S,b){var _={name:g,delta:y,target:S,should:b,shadowParent:Wi(S)};e.current.push(_),setTimeout(function(){e.current=e.current.filter(function(k){return k!==_})},1)},[]),u=p.useCallback(function(g){t.current=yt(g),r.current=void 0},[]),h=p.useCallback(function(g){c(g.type,_n(g),g.target,a(g,n.lockRef.current))},[]),d=p.useCallback(function(g){c(g.type,yt(g),g.target,a(g,n.lockRef.current))},[]);p.useEffect(function(){return ze.push(o),n.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:d}),document.addEventListener("wheel",l,Ue),document.addEventListener("touchmove",l,Ue),document.addEventListener("touchstart",u,Ue),function(){ze=ze.filter(function(g){return g!==o}),document.removeEventListener("wheel",l,Ue),document.removeEventListener("touchmove",l,Ue),document.removeEventListener("touchstart",u,Ue)}},[]);var f=n.removeScrollBar,v=n.inert;return p.createElement(p.Fragment,null,v?p.createElement(o,{styles:Fi(s)}):null,f?p.createElement(Ri,{gapMode:n.gapMode}):null)}function Wi(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const Hi=yi(pn,qi);var xn=p.forwardRef(function(n,e){return p.createElement(vt,fe({},n,{ref:e,sideCar:Hi}))});xn.classNames=vt.classNames;var Vi=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},Fe=new WeakMap,wt=new WeakMap,_t={},sr=0,Sn=function(n){return n&&(n.host||Sn(n.parentNode))},Gi=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=Sn(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},Ji=function(n,e,t,r){var s=Gi(e,Array.isArray(n)?n:[n]);_t[t]||(_t[t]=new WeakMap);var o=_t[t],i=[],a=new Set,l=new Set(s),c=function(h){!h||a.has(h)||(a.add(h),c(h.parentNode))};s.forEach(c);var u=function(h){!h||l.has(h)||Array.prototype.forEach.call(h.children,function(d){if(a.has(d))u(d);else try{var f=d.getAttribute(r),v=f!==null&&f!=="false",g=(Fe.get(d)||0)+1,y=(o.get(d)||0)+1;Fe.set(d,g),o.set(d,y),i.push(d),g===1&&v&&wt.set(d,!0),y===1&&d.setAttribute(t,"true"),v||d.setAttribute(r,"true")}catch(S){console.error("aria-hidden: cannot operate on ",d,S)}})};return u(e),a.clear(),sr++,function(){i.forEach(function(h){var d=Fe.get(h)-1,f=o.get(h)-1;Fe.set(h,d),o.set(h,f),d||(wt.has(h)||h.removeAttribute(r),wt.delete(h)),f||h.removeAttribute(t)}),sr--,sr||(Fe=new WeakMap,Fe=new WeakMap,wt=new WeakMap,_t={})}},Ki=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),s=Vi(n);return s?(r.push.apply(r,Array.from(s.querySelectorAll("[aria-live]"))),Ji(r,s,t,"aria-hidden")):function(){return null}},or="Dialog",[En,hd]=Yr(or),[Yi,ue]=En(or),Cn=n=>{const{__scopeDialog:e,children:t,open:r,defaultOpen:s,onOpenChange:o,modal:i=!0}=n,a=p.useRef(null),l=p.useRef(null),[c=!1,u]=Do({prop:r,defaultProp:s,onChange:o});return m.jsx(Yi,{scope:e,triggerRef:a,contentRef:l,contentId:Gt(),titleId:Gt(),descriptionId:Gt(),open:c,onOpenChange:u,onOpenToggle:p.useCallback(()=>u(h=>!h),[u]),modal:i,children:t})};Cn.displayName=or;var Tn="DialogTrigger",An=p.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=ue(Tn,t),o=oe(e,s.triggerRef);return m.jsx(te.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":lr(s.open),...r,ref:o,onClick:Q(n.onClick,s.onOpenToggle)})});An.displayName=Tn;var ir="DialogPortal",[Xi,Pn]=En(ir,{forceMount:void 0}),$n=n=>{const{__scopeDialog:e,forceMount:t,children:r,container:s}=n,o=ue(ir,e);return m.jsx(Xi,{scope:e,forceMount:t,children:p.Children.map(r,i=>m.jsx(_e,{present:t||o.open,children:m.jsx(cn,{asChild:!0,container:s,children:i})}))})};$n.displayName=ir;var kt="DialogOverlay",jn=p.forwardRef((n,e)=>{const t=Pn(kt,n.__scopeDialog),{forceMount:r=t.forceMount,...s}=n,o=ue(kt,n.__scopeDialog);return o.modal?m.jsx(_e,{present:r||o.open,children:m.jsx(Zi,{...s,ref:e})}):null});jn.displayName=kt;var Zi=p.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=ue(kt,t);return m.jsx(xn,{as:Jt,allowPinchZoom:!0,shards:[s.contentRef],children:m.jsx(te.div,{"data-state":lr(s.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),$e="DialogContent",Rn=p.forwardRef((n,e)=>{const t=Pn($e,n.__scopeDialog),{forceMount:r=t.forceMount,...s}=n,o=ue($e,n.__scopeDialog);return m.jsx(_e,{present:r||o.open,children:o.modal?m.jsx(Qi,{...s,ref:e}):m.jsx(ea,{...s,ref:e})})});Rn.displayName=$e;var Qi=p.forwardRef((n,e)=>{const t=ue($e,n.__scopeDialog),r=p.useRef(null),s=oe(e,t.contentRef,r);return p.useEffect(()=>{const o=r.current;if(o)return Ki(o)},[]),m.jsx(On,{...n,ref:s,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Q(n.onCloseAutoFocus,o=>{var i;o.preventDefault(),(i=t.triggerRef.current)==null||i.focus()}),onPointerDownOutside:Q(n.onPointerDownOutside,o=>{const i=o.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&o.preventDefault()}),onFocusOutside:Q(n.onFocusOutside,o=>o.preventDefault())})}),ea=p.forwardRef((n,e)=>{const t=ue($e,n.__scopeDialog),r=p.useRef(!1),s=p.useRef(!1);return m.jsx(On,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i,a;(i=n.onCloseAutoFocus)==null||i.call(n,o),o.defaultPrevented||(r.current||(a=t.triggerRef.current)==null||a.focus(),o.preventDefault()),r.current=!1,s.current=!1},onInteractOutside:o=>{var l,c;(l=n.onInteractOutside)==null||l.call(n,o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const i=o.target;((c=t.triggerRef.current)==null?void 0:c.contains(i))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),On=p.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:r,onOpenAutoFocus:s,onCloseAutoFocus:o,...i}=n,a=ue($e,t),l=p.useRef(null),c=oe(e,l);return ci(),m.jsxs(m.Fragment,{children:[m.jsx(nn,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:s,onUnmountAutoFocus:o,children:m.jsx(Qr,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":lr(a.open),...i,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),m.jsxs(m.Fragment,{children:[m.jsx(ta,{titleId:a.titleId}),m.jsx(na,{contentRef:l,descriptionId:a.descriptionId})]})]})}),ar="DialogTitle",In=p.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=ue(ar,t);return m.jsx(te.h2,{id:s.titleId,...r,ref:e})});In.displayName=ar;var Ln="DialogDescription",Dn=p.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=ue(Ln,t);return m.jsx(te.p,{id:s.descriptionId,...r,ref:e})});Dn.displayName=Ln;var Nn="DialogClose",Mn=p.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=ue(Nn,t);return m.jsx(te.button,{type:"button",...r,ref:e,onClick:Q(n.onClick,()=>s.onOpenChange(!1))})});Mn.displayName=Nn;function lr(n){return n?"open":"closed"}var Un="DialogTitleWarning",[fd,zn]=Ro(Un,{contentName:$e,titleName:ar,docsSlug:"dialog"}),ta=({titleId:n})=>{const e=zn(Un),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return p.useEffect(()=>{n&&(document.getElementById(n)||console.error(t))},[t,n]),null},ra="DialogDescriptionWarning",na=({contentRef:n,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${zn(ra).contentName}}.`;return p.useEffect(()=>{var o;const s=(o=n.current)==null?void 0:o.getAttribute("aria-describedby");e&&s&&(document.getElementById(e)||console.warn(r))},[r,n,e]),null},sa=Cn,oa=An,ia=$n,Fn=jn,Bn=Rn,qn=In,Wn=Dn,aa=Mn;/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Hn=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ca={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=C.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:s="",children:o,iconNode:i,...a},l)=>C.createElement("svg",{ref:l,...ca,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:Hn("lucide",s),...a},[...i.map(([c,u])=>C.createElement(c,u)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=(n,e)=>{const t=C.forwardRef(({className:r,...s},o)=>C.createElement(ua,{ref:o,iconNode:e,className:Hn(`lucide-${la(n)}`,r),...s}));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=xt("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=xt("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=xt("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=xt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function Vn(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=Vn(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function ga(){for(var n,e,t=0,r="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=Vn(n))&&(r&&(r+=" "),r+=e);return r}const cr="-",ma=n=>{const e=ba(n),{conflictingClassGroups:t,conflictingClassGroupModifiers:r}=n;return{getClassGroupId:i=>{const a=i.split(cr);return a[0]===""&&a.length!==1&&a.shift(),Gn(a,e)||va(i)},getConflictingClassGroupIds:(i,a)=>{const l=t[i]||[];return a&&r[i]?[...l,...r[i]]:l}}},Gn=(n,e)=>{var i;if(n.length===0)return e.classGroupId;const t=n[0],r=e.nextPart.get(t),s=r?Gn(n.slice(1),r):void 0;if(s)return s;if(e.validators.length===0)return;const o=n.join(cr);return(i=e.validators.find(({validator:a})=>a(o)))==null?void 0:i.classGroupId},Jn=/^\[(.+)\]$/,va=n=>{if(Jn.test(n)){const e=Jn.exec(n)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},ba=n=>{const{theme:e,prefix:t}=n,r={nextPart:new Map,validators:[]};return wa(Object.entries(n.classGroups),t).forEach(([o,i])=>{ur(i,r,o,e)}),r},ur=(n,e,t,r)=>{n.forEach(s=>{if(typeof s=="string"){const o=s===""?e:Kn(e,s);o.classGroupId=t;return}if(typeof s=="function"){if(ya(s)){ur(s(r),e,t,r);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([o,i])=>{ur(i,Kn(e,o),t,r)})})},Kn=(n,e)=>{let t=n;return e.split(cr).forEach(r=>{t.nextPart.has(r)||t.nextPart.set(r,{nextPart:new Map,validators:[]}),t=t.nextPart.get(r)}),t},ya=n=>n.isThemeGetter,wa=(n,e)=>e?n.map(([t,r])=>{const s=r.map(o=>typeof o=="string"?e+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([i,a])=>[e+i,a])):o);return[t,s]}):n,_a=n=>{if(n<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,r=new Map;const s=(o,i)=>{t.set(o,i),e++,e>n&&(e=0,r=t,t=new Map)};return{get(o){let i=t.get(o);if(i!==void 0)return i;if((i=r.get(o))!==void 0)return s(o,i),i},set(o,i){t.has(o)?t.set(o,i):s(o,i)}}},Yn="!",ka=n=>{const{separator:e,experimentalParseClassName:t}=n,r=e.length===1,s=e[0],o=e.length,i=a=>{const l=[];let c=0,u=0,h;for(let y=0;y<a.length;y++){let S=a[y];if(c===0){if(S===s&&(r||a.slice(y,y+o)===e)){l.push(a.slice(u,y)),u=y+o;continue}if(S==="/"){h=y;continue}}S==="["?c++:S==="]"&&c--}const d=l.length===0?a:a.substring(u),f=d.startsWith(Yn),v=f?d.substring(1):d,g=h&&h>u?h-u:void 0;return{modifiers:l,hasImportantModifier:f,baseClassName:v,maybePostfixModifierPosition:g}};return t?a=>t({className:a,parseClassName:i}):i},xa=n=>{if(n.length<=1)return n;const e=[];let t=[];return n.forEach(r=>{r[0]==="["?(e.push(...t.sort(),r),t=[]):t.push(r)}),e.push(...t.sort()),e},Sa=n=>({cache:_a(n.cacheSize),parseClassName:ka(n),...ma(n)}),Ea=/\s+/,Ca=(n,e)=>{const{parseClassName:t,getClassGroupId:r,getConflictingClassGroupIds:s}=e,o=[],i=n.trim().split(Ea);let a="";for(let l=i.length-1;l>=0;l-=1){const c=i[l],{modifiers:u,hasImportantModifier:h,baseClassName:d,maybePostfixModifierPosition:f}=t(c);let v=!!f,g=r(v?d.substring(0,f):d);if(!g){if(!v){a=c+(a.length>0?" "+a:a);continue}if(g=r(d),!g){a=c+(a.length>0?" "+a:a);continue}v=!1}const y=xa(u).join(":"),S=h?y+Yn:y,b=S+g;if(o.includes(b))continue;o.push(b);const _=s(g,v);for(let k=0;k<_.length;++k){const E=_[k];o.push(S+E)}a=c+(a.length>0?" "+a:a)}return a};function Ta(){let n=0,e,t,r="";for(;n<arguments.length;)(e=arguments[n++])&&(t=Xn(e))&&(r&&(r+=" "),r+=t);return r}const Xn=n=>{if(typeof n=="string")return n;let e,t="";for(let r=0;r<n.length;r++)n[r]&&(e=Xn(n[r]))&&(t&&(t+=" "),t+=e);return t};function Aa(n,...e){let t,r,s,o=i;function i(l){const c=e.reduce((u,h)=>h(u),n());return t=Sa(c),r=t.cache.get,s=t.cache.set,o=a,a(l)}function a(l){const c=r(l);if(c)return c;const u=Ca(l,t);return s(l,u),u}return function(){return o(Ta.apply(null,arguments))}}const H=n=>{const e=t=>t[n]||[];return e.isThemeGetter=!0,e},Zn=/^\[(?:([a-z-]+):)?(.+)\]$/i,Pa=/^\d+\/\d+$/,$a=new Set(["px","full","screen"]),ja=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Ra=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Oa=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Ia=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,La=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,be=n=>Be(n)||$a.has(n)||Pa.test(n),ke=n=>qe(n,"length",qa),Be=n=>!!n&&!Number.isNaN(Number(n)),dr=n=>qe(n,"number",Be),tt=n=>!!n&&Number.isInteger(Number(n)),Da=n=>n.endsWith("%")&&Be(n.slice(0,-1)),L=n=>Zn.test(n),xe=n=>ja.test(n),Na=new Set(["length","size","percentage"]),Ma=n=>qe(n,Na,Qn),Ua=n=>qe(n,"position",Qn),za=new Set(["image","url"]),Fa=n=>qe(n,za,Ha),Ba=n=>qe(n,"",Wa),rt=()=>!0,qe=(n,e,t)=>{const r=Zn.exec(n);return r?r[1]?typeof e=="string"?r[1]===e:e.has(r[1]):t(r[2]):!1},qa=n=>Ra.test(n)&&!Oa.test(n),Qn=()=>!1,Wa=n=>Ia.test(n),Ha=n=>La.test(n),Va=Aa(()=>{const n=H("colors"),e=H("spacing"),t=H("blur"),r=H("brightness"),s=H("borderColor"),o=H("borderRadius"),i=H("borderSpacing"),a=H("borderWidth"),l=H("contrast"),c=H("grayscale"),u=H("hueRotate"),h=H("invert"),d=H("gap"),f=H("gradientColorStops"),v=H("gradientColorStopPositions"),g=H("inset"),y=H("margin"),S=H("opacity"),b=H("padding"),_=H("saturate"),k=H("scale"),E=H("sepia"),A=H("skew"),$=H("space"),O=H("translate"),P=()=>["auto","contain","none"],U=()=>["auto","hidden","clip","visible","scroll"],G=()=>["auto",L,e],I=()=>[L,e],ht=()=>["",be,ke],Qe=()=>["auto",Be,L],Ht=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],w=()=>["solid","dashed","dotted","double","none"],x=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],R=()=>["start","end","center","between","around","evenly","stretch"],q=()=>["","0",L],M=()=>["auto","avoid","all","avoid-page","page","left","right","column"],K=()=>[Be,L];return{cacheSize:500,separator:":",theme:{colors:[rt],spacing:[be,ke],blur:["none","",xe,L],brightness:K(),borderColor:[n],borderRadius:["none","","full",xe,L],borderSpacing:I(),borderWidth:ht(),contrast:K(),grayscale:q(),hueRotate:K(),invert:q(),gap:I(),gradientColorStops:[n],gradientColorStopPositions:[Da,ke],inset:G(),margin:G(),opacity:K(),padding:I(),saturate:K(),scale:K(),sepia:q(),skew:K(),space:I(),translate:I()},classGroups:{aspect:[{aspect:["auto","square","video",L]}],container:["container"],columns:[{columns:[xe]}],"break-after":[{"break-after":M()}],"break-before":[{"break-before":M()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Ht(),L]}],overflow:[{overflow:U()}],"overflow-x":[{"overflow-x":U()}],"overflow-y":[{"overflow-y":U()}],overscroll:[{overscroll:P()}],"overscroll-x":[{"overscroll-x":P()}],"overscroll-y":[{"overscroll-y":P()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",tt,L]}],basis:[{basis:G()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",L]}],grow:[{grow:q()}],shrink:[{shrink:q()}],order:[{order:["first","last","none",tt,L]}],"grid-cols":[{"grid-cols":[rt]}],"col-start-end":[{col:["auto",{span:["full",tt,L]},L]}],"col-start":[{"col-start":Qe()}],"col-end":[{"col-end":Qe()}],"grid-rows":[{"grid-rows":[rt]}],"row-start-end":[{row:["auto",{span:[tt,L]},L]}],"row-start":[{"row-start":Qe()}],"row-end":[{"row-end":Qe()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",L]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",L]}],gap:[{gap:[d]}],"gap-x":[{"gap-x":[d]}],"gap-y":[{"gap-y":[d]}],"justify-content":[{justify:["normal",...R()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...R(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...R(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[b]}],px:[{px:[b]}],py:[{py:[b]}],ps:[{ps:[b]}],pe:[{pe:[b]}],pt:[{pt:[b]}],pr:[{pr:[b]}],pb:[{pb:[b]}],pl:[{pl:[b]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[$]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[$]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",L,e]}],"min-w":[{"min-w":[L,e,"min","max","fit"]}],"max-w":[{"max-w":[L,e,"none","full","min","max","fit","prose",{screen:[xe]},xe]}],h:[{h:[L,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[L,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[L,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[L,e,"auto","min","max","fit"]}],"font-size":[{text:["base",xe,ke]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",dr]}],"font-family":[{font:[rt]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",L]}],"line-clamp":[{"line-clamp":["none",Be,dr]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",be,L]}],"list-image":[{"list-image":["none",L]}],"list-style-type":[{list:["none","disc","decimal",L]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[n]}],"placeholder-opacity":[{"placeholder-opacity":[S]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[n]}],"text-opacity":[{"text-opacity":[S]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...w(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",be,ke]}],"underline-offset":[{"underline-offset":["auto",be,L]}],"text-decoration-color":[{decoration:[n]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:I()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",L]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",L]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[S]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Ht(),Ua]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Ma]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Fa]}],"bg-color":[{bg:[n]}],"gradient-from-pos":[{from:[v]}],"gradient-via-pos":[{via:[v]}],"gradient-to-pos":[{to:[v]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[S]}],"border-style":[{border:[...w(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[S]}],"divide-style":[{divide:w()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["",...w()]}],"outline-offset":[{"outline-offset":[be,L]}],"outline-w":[{outline:[be,ke]}],"outline-color":[{outline:[n]}],"ring-w":[{ring:ht()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[n]}],"ring-opacity":[{"ring-opacity":[S]}],"ring-offset-w":[{"ring-offset":[be,ke]}],"ring-offset-color":[{"ring-offset":[n]}],shadow:[{shadow:["","inner","none",xe,Ba]}],"shadow-color":[{shadow:[rt]}],opacity:[{opacity:[S]}],"mix-blend":[{"mix-blend":[...x(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":x()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",xe,L]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[h]}],saturate:[{saturate:[_]}],sepia:[{sepia:[E]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[S]}],"backdrop-saturate":[{"backdrop-saturate":[_]}],"backdrop-sepia":[{"backdrop-sepia":[E]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",L]}],duration:[{duration:K()}],ease:[{ease:["linear","in","out","in-out",L]}],delay:[{delay:K()}],animate:[{animate:["none","spin","ping","pulse","bounce",L]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[k]}],"scale-x":[{"scale-x":[k]}],"scale-y":[{"scale-y":[k]}],rotate:[{rotate:[tt,L]}],"translate-x":[{"translate-x":[O]}],"translate-y":[{"translate-y":[O]}],"skew-x":[{"skew-x":[A]}],"skew-y":[{"skew-y":[A]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",L]}],accent:[{accent:["auto",n]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",L]}],"caret-color":[{caret:[n]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":I()}],"scroll-mx":[{"scroll-mx":I()}],"scroll-my":[{"scroll-my":I()}],"scroll-ms":[{"scroll-ms":I()}],"scroll-me":[{"scroll-me":I()}],"scroll-mt":[{"scroll-mt":I()}],"scroll-mr":[{"scroll-mr":I()}],"scroll-mb":[{"scroll-mb":I()}],"scroll-ml":[{"scroll-ml":I()}],"scroll-p":[{"scroll-p":I()}],"scroll-px":[{"scroll-px":I()}],"scroll-py":[{"scroll-py":I()}],"scroll-ps":[{"scroll-ps":I()}],"scroll-pe":[{"scroll-pe":I()}],"scroll-pt":[{"scroll-pt":I()}],"scroll-pr":[{"scroll-pr":I()}],"scroll-pb":[{"scroll-pb":I()}],"scroll-pl":[{"scroll-pl":I()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",L]}],fill:[{fill:[n,"none"]}],"stroke-w":[{stroke:[be,ke,dr]}],stroke:[{stroke:[n,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}});function Se(...n){return Va(ga(n))}const Ga=sa,Ja=oa,Ka=ia,es=p.forwardRef(({className:n,...e},t)=>m.jsx(Fn,{ref:t,className:Se("fixed inset-0 z-50 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...e}));es.displayName=Fn.displayName;const ts=p.forwardRef(({className:n,children:e,...t},r)=>m.jsxs(Ka,{children:[m.jsx(es,{}),m.jsxs(Bn,{ref:r,className:Se("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...t,children:[e,m.jsxs(aa,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[m.jsx(pa,{className:"h-4 w-4"}),m.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ts.displayName=Bn.displayName;const Ya=p.forwardRef(({className:n,...e},t)=>m.jsx(qn,{ref:t,className:Se("text-lg font-semibold leading-none tracking-tight",n),...e}));Ya.displayName=qn.displayName;const Xa=p.forwardRef(({className:n,...e},t)=>m.jsx(Wn,{ref:t,className:Se("text-sm text-muted-foreground",n),...e}));Xa.displayName=Wn.displayName;const rs=C.forwardRef((n,e)=>m.jsx("button",{ref:e,className:"fixed bottom-6 right-6 h-12 w-12 rounded-full bg-gradient-to-t from-blue-500 to-blue-300 shadow-lg flex items-center justify-center z-50 transition-transform hover:scale-105",onClick:n.onClick,children:m.jsx("div",{className:"h-4 w-4 bg-white opacity-40 rounded-full"})}));rs.displayName="VoiceDialogTrigger";var ns=["light","dark"],Za="(prefers-color-scheme: dark)";p.createContext(void 0),p.memo(({forcedTheme:n,storageKey:e,attribute:t,enableSystem:r,enableColorScheme:s,defaultTheme:o,value:i,attrs:a,nonce:l})=>{let c=o==="system",u=t==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${a.map(v=>`'${v}'`).join(",")})`};`:`var d=document.documentElement,n='${t}',s='setAttribute';`,h=s?ns.includes(o)&&o?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${o}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",d=(v,g=!1,y=!0)=>{let S=i?i[v]:v,b=g?v+"|| ''":`'${S}'`,_="";return s&&y&&!g&&ns.includes(v)&&(_+=`d.style.colorScheme = '${v}';`),t==="class"?g||S?_+=`c.add(${b})`:_+="null":S&&(_+=`d[s](n,${b})`),_},f=n?`!function(){${u}${d(n)}}()`:r?`!function(){try{${u}var e=localStorage.getItem('${e}');if('system'===e||(!e&&${c})){var t='${Za}',m=window.matchMedia(t);if(m.media!==t||m.matches){${d("dark")}}else{${d("light")}}}else if(e){${i?`var x=${JSON.stringify(i)};`:""}${d(i?"x[e]":"e",!0)}}${c?"":"else{"+d(o,!1,!1)+"}"}${h}}catch(e){}}()`:`!function(){try{${u}var e=localStorage.getItem('${e}');if(e){${i?`var x=${JSON.stringify(i)};`:""}${d(i?"x[e]":"e",!0)}}else{${d(o,!1,!1)};}${h}}catch(t){}}();`;return p.createElement("script",{nonce:l,dangerouslySetInnerHTML:{__html:f}})}),Array(12).fill(0),C.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},C.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),C.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},C.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),C.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},C.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),C.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},C.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"}));var hr=1,Qa=class{constructor(){this.subscribe=n=>(this.subscribers.push(n),()=>{let e=this.subscribers.indexOf(n);this.subscribers.splice(e,1)}),this.publish=n=>{this.subscribers.forEach(e=>e(n))},this.addToast=n=>{this.publish(n),this.toasts=[...this.toasts,n]},this.create=n=>{var e;let{message:t,...r}=n,s=typeof(n==null?void 0:n.id)=="number"||((e=n.id)==null?void 0:e.length)>0?n.id:hr++,o=this.toasts.find(a=>a.id===s),i=n.dismissible===void 0?!0:n.dismissible;return o?this.toasts=this.toasts.map(a=>a.id===s?(this.publish({...a,...n,id:s,title:t}),{...a,...n,id:s,dismissible:i,title:t}):a):this.addToast({title:t,...r,dismissible:i,id:s}),s},this.dismiss=n=>(n||this.toasts.forEach(e=>{this.subscribers.forEach(t=>t({id:e.id,dismiss:!0}))}),this.subscribers.forEach(e=>e({id:n,dismiss:!0})),n),this.message=(n,e)=>this.create({...e,message:n}),this.error=(n,e)=>this.create({...e,message:n,type:"error"}),this.success=(n,e)=>this.create({...e,type:"success",message:n}),this.info=(n,e)=>this.create({...e,type:"info",message:n}),this.warning=(n,e)=>this.create({...e,type:"warning",message:n}),this.loading=(n,e)=>this.create({...e,type:"loading",message:n}),this.promise=(n,e)=>{if(!e)return;let t;e.loading!==void 0&&(t=this.create({...e,promise:n,type:"loading",message:e.loading,description:typeof e.description!="function"?e.description:void 0}));let r=n instanceof Promise?n:n(),s=t!==void 0;return r.then(async o=>{if(tl(o)&&!o.ok){s=!1;let i=typeof e.error=="function"?await e.error(`HTTP error! status: ${o.status}`):e.error,a=typeof e.description=="function"?await e.description(`HTTP error! status: ${o.status}`):e.description;this.create({id:t,type:"error",message:i,description:a})}else if(e.success!==void 0){s=!1;let i=typeof e.success=="function"?await e.success(o):e.success,a=typeof e.description=="function"?await e.description(o):e.description;this.create({id:t,type:"success",message:i,description:a})}}).catch(async o=>{if(e.error!==void 0){s=!1;let i=typeof e.error=="function"?await e.error(o):e.error,a=typeof e.description=="function"?await e.description(o):e.description;this.create({id:t,type:"error",message:i,description:a})}}).finally(()=>{var o;s&&(this.dismiss(t),t=void 0),(o=e.finally)==null||o.call(e)}),t},this.custom=(n,e)=>{let t=(e==null?void 0:e.id)||hr++;return this.create({jsx:n(t),id:t,...e}),t},this.subscribers=[],this.toasts=[]}},de=new Qa,el=(n,e)=>{let t=(e==null?void 0:e.id)||hr++;return de.addToast({title:n,...e,id:t}),t},tl=n=>n&&typeof n=="object"&&"ok"in n&&typeof n.ok=="boolean"&&"status"in n&&typeof n.status=="number",rl=el,nl=()=>de.toasts,J=Object.assign(rl,{success:de.success,info:de.info,warning:de.warning,error:de.error,custom:de.custom,message:de.message,promise:de.promise,dismiss:de.dismiss,loading:de.loading},{getHistory:nl});function sl(n,{insertAt:e}={}){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",e==="top"&&t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}sl(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);const ol=({isListening:n,isSpeaking:e,voiceVolume:t,onClick:r})=>{const[s,o]=C.useState(""),[i,a]=C.useState("opacity-30");C.useEffect(()=>{let f;return e?(o("animate-pulse-wave"),a("opacity-70")):f=setTimeout(()=>{o(""),a("opacity-30")},500),()=>{f&&clearTimeout(f)}},[e]);const l=()=>{if(!e)return 1;const f=1,v=t*.04;return f+v},u=(()=>{if(e){if(t>7)return"animate-wave-high";if(t>3)return"animate-wave"}return"animate-wave-low"})(),h=l(),d=async()=>{try{r()}catch(f){console.error("Ошибка при активации голосового ассистента:",f),J.error("Не удалось активировать голосовой ассистент")}};return m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:`absolute inset-0 scale-150 rounded-full blur-xl transition-opacity duration-700 ${i}`,children:m.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-radial from-blue-400 via-blue-300 to-transparent opacity-80 animate-pulse",style:{animationDuration:"4s"}})}),m.jsxs("div",{className:"relative h-16 w-16 rounded-full bg-gradient-to-t from-blue-500 to-blue-200 shadow-lg cursor-pointer transition-all duration-200 ease-in-out",onClick:d,style:{transform:`scale(${h})`},children:[m.jsx("div",{className:"absolute inset-0 opacity-90 rounded-full overflow-hidden",children:m.jsxs("div",{className:"absolute bottom-0 left-0 right-0 h-1/2 bg-opacity-20",children:[m.jsx("div",{className:`absolute bottom-0 left-0 w-full h-5 bg-white opacity-20 rounded-full transform -translate-y-2 ${u}`}),m.jsx("div",{className:`absolute bottom-0 left-0 w-full h-4 bg-white opacity-30 rounded-full transform -translate-y-1 translate-x-2 ${u}`}),m.jsx("div",{className:`absolute bottom-0 left-0 w-full h-3 bg-white opacity-40 rounded-full transform ${u}`})]})}),e&&m.jsx("div",{className:"absolute -inset-4 rounded-full blur-md bg-gradient-to-r from-blue-400/40 via-blue-300/30 to-blue-200/20 animate-pulse",style:{animationDuration:"2s"}}),n&&m.jsx("div",{className:"absolute -top-1 -right-1 h-3 w-3 rounded-full bg-red-500 animate-pulse"})]})]})},il=({isListening:n,isSpeaking:e})=>{const t=()=>e?"Ассистент говорит...":n?"Ассистент слушает...":"Нажмите на круг для активации ассистента";return m.jsx("div",{className:"w-full text-center mb-4",children:m.jsx("h2",{className:"text-xl font-medium text-gray-100 h-8 flex items-center justify-center transition-all duration-300",children:t()})})};var al=p.createContext(void 0);function ll(n){const e=p.useContext(al);return n||e||"ltr"}function cl(n,[e,t]){return Math.min(t,Math.max(e,n))}function ul(n,e){return p.useReducer((t,r)=>e[t][r]??t,n)}var fr="ScrollArea",[ss,gd]=Yr(fr),[dl,ce]=ss(fr),os=p.forwardRef((n,e)=>{const{__scopeScrollArea:t,type:r="hover",dir:s,scrollHideDelay:o=600,...i}=n,[a,l]=p.useState(null),[c,u]=p.useState(null),[h,d]=p.useState(null),[f,v]=p.useState(null),[g,y]=p.useState(null),[S,b]=p.useState(0),[_,k]=p.useState(0),[E,A]=p.useState(!1),[$,O]=p.useState(!1),P=oe(e,G=>l(G)),U=ll(s);return m.jsx(dl,{scope:t,type:r,dir:U,scrollHideDelay:o,scrollArea:a,viewport:c,onViewportChange:u,content:h,onContentChange:d,scrollbarX:f,onScrollbarXChange:v,scrollbarXEnabled:E,onScrollbarXEnabledChange:A,scrollbarY:g,onScrollbarYChange:y,scrollbarYEnabled:$,onScrollbarYEnabledChange:O,onCornerWidthChange:b,onCornerHeightChange:k,children:m.jsx(te.div,{dir:U,...i,ref:P,style:{position:"relative","--radix-scroll-area-corner-width":S+"px","--radix-scroll-area-corner-height":_+"px",...n.style}})})});os.displayName=fr;var is="ScrollAreaViewport",as=p.forwardRef((n,e)=>{const{__scopeScrollArea:t,children:r,asChild:s,nonce:o,...i}=n,a=ce(is,t),l=p.useRef(null),c=oe(e,l,a.onViewportChange);return m.jsxs(m.Fragment,{children:[m.jsx("style",{dangerouslySetInnerHTML:{__html:`
[data-radix-scroll-area-viewport] {
  scrollbar-width: none;
  -ms-overflow-style: none;
  -webkit-overflow-scrolling: touch;
}
[data-radix-scroll-area-viewport]::-webkit-scrollbar {
  display: none;
}
:where([data-radix-scroll-area-viewport]) {
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
:where([data-radix-scroll-area-content]) {
  flex-grow: 1;
}
`},nonce:o}),m.jsx(te.div,{"data-radix-scroll-area-viewport":"",...i,asChild:s,ref:c,style:{overflowX:a.scrollbarXEnabled?"scroll":"hidden",overflowY:a.scrollbarYEnabled?"scroll":"hidden",...n.style},children:_l({asChild:s,children:r},u=>m.jsx("div",{"data-radix-scroll-area-content":"",ref:a.onContentChange,style:{minWidth:a.scrollbarXEnabled?"fit-content":void 0},children:u}))})]})});as.displayName=is;var pe="ScrollAreaScrollbar",pr=p.forwardRef((n,e)=>{const{forceMount:t,...r}=n,s=ce(pe,n.__scopeScrollArea),{onScrollbarXEnabledChange:o,onScrollbarYEnabledChange:i}=s,a=n.orientation==="horizontal";return p.useEffect(()=>(a?o(!0):i(!0),()=>{a?o(!1):i(!1)}),[a,o,i]),s.type==="hover"?m.jsx(hl,{...r,ref:e,forceMount:t}):s.type==="scroll"?m.jsx(fl,{...r,ref:e,forceMount:t}):s.type==="auto"?m.jsx(ls,{...r,ref:e,forceMount:t}):s.type==="always"?m.jsx(gr,{...r,ref:e}):null});pr.displayName=pe;var hl=p.forwardRef((n,e)=>{const{forceMount:t,...r}=n,s=ce(pe,n.__scopeScrollArea),[o,i]=p.useState(!1);return p.useEffect(()=>{const a=s.scrollArea;let l=0;if(a){const c=()=>{window.clearTimeout(l),i(!0)},u=()=>{l=window.setTimeout(()=>i(!1),s.scrollHideDelay)};return a.addEventListener("pointerenter",c),a.addEventListener("pointerleave",u),()=>{window.clearTimeout(l),a.removeEventListener("pointerenter",c),a.removeEventListener("pointerleave",u)}}},[s.scrollArea,s.scrollHideDelay]),m.jsx(_e,{present:t||o,children:m.jsx(ls,{"data-state":o?"visible":"hidden",...r,ref:e})})}),fl=p.forwardRef((n,e)=>{const{forceMount:t,...r}=n,s=ce(pe,n.__scopeScrollArea),o=n.orientation==="horizontal",i=Tt(()=>l("SCROLL_END"),100),[a,l]=ul("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return p.useEffect(()=>{if(a==="idle"){const c=window.setTimeout(()=>l("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(c)}},[a,s.scrollHideDelay,l]),p.useEffect(()=>{const c=s.viewport,u=o?"scrollLeft":"scrollTop";if(c){let h=c[u];const d=()=>{const f=c[u];h!==f&&(l("SCROLL"),i()),h=f};return c.addEventListener("scroll",d),()=>c.removeEventListener("scroll",d)}},[s.viewport,o,l,i]),m.jsx(_e,{present:t||a!=="hidden",children:m.jsx(gr,{"data-state":a==="hidden"?"hidden":"visible",...r,ref:e,onPointerEnter:Q(n.onPointerEnter,()=>l("POINTER_ENTER")),onPointerLeave:Q(n.onPointerLeave,()=>l("POINTER_LEAVE"))})})}),ls=p.forwardRef((n,e)=>{const t=ce(pe,n.__scopeScrollArea),{forceMount:r,...s}=n,[o,i]=p.useState(!1),a=n.orientation==="horizontal",l=Tt(()=>{if(t.viewport){const c=t.viewport.offsetWidth<t.viewport.scrollWidth,u=t.viewport.offsetHeight<t.viewport.scrollHeight;i(a?c:u)}},10);return We(t.viewport,l),We(t.content,l),m.jsx(_e,{present:r||o,children:m.jsx(gr,{"data-state":o?"visible":"hidden",...s,ref:e})})}),gr=p.forwardRef((n,e)=>{const{orientation:t="vertical",...r}=n,s=ce(pe,n.__scopeScrollArea),o=p.useRef(null),i=p.useRef(0),[a,l]=p.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),c=fs(a.viewport,a.content),u={...r,sizes:a,onSizesChange:l,hasThumb:c>0&&c<1,onThumbChange:d=>o.current=d,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:d=>i.current=d};function h(d,f){return yl(d,i.current,a,f)}return t==="horizontal"?m.jsx(pl,{...u,ref:e,onThumbPositionChange:()=>{if(s.viewport&&o.current){const d=s.viewport.scrollLeft,f=ps(d,a,s.dir);o.current.style.transform=`translate3d(${f}px, 0, 0)`}},onWheelScroll:d=>{s.viewport&&(s.viewport.scrollLeft=d)},onDragScroll:d=>{s.viewport&&(s.viewport.scrollLeft=h(d,s.dir))}}):t==="vertical"?m.jsx(gl,{...u,ref:e,onThumbPositionChange:()=>{if(s.viewport&&o.current){const d=s.viewport.scrollTop,f=ps(d,a);o.current.style.transform=`translate3d(0, ${f}px, 0)`}},onWheelScroll:d=>{s.viewport&&(s.viewport.scrollTop=d)},onDragScroll:d=>{s.viewport&&(s.viewport.scrollTop=h(d))}}):null}),pl=p.forwardRef((n,e)=>{const{sizes:t,onSizesChange:r,...s}=n,o=ce(pe,n.__scopeScrollArea),[i,a]=p.useState(),l=p.useRef(null),c=oe(e,l,o.onScrollbarXChange);return p.useEffect(()=>{l.current&&a(getComputedStyle(l.current))},[l]),m.jsx(us,{"data-orientation":"horizontal",...s,ref:c,sizes:t,style:{bottom:0,left:o.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:o.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Ct(t)+"px",...n.style},onThumbPointerDown:u=>n.onThumbPointerDown(u.x),onDragScroll:u=>n.onDragScroll(u.x),onWheelScroll:(u,h)=>{if(o.viewport){const d=o.viewport.scrollLeft+u.deltaX;n.onWheelScroll(d),ms(d,h)&&u.preventDefault()}},onResize:()=>{l.current&&o.viewport&&i&&r({content:o.viewport.scrollWidth,viewport:o.viewport.offsetWidth,scrollbar:{size:l.current.clientWidth,paddingStart:Et(i.paddingLeft),paddingEnd:Et(i.paddingRight)}})}})}),gl=p.forwardRef((n,e)=>{const{sizes:t,onSizesChange:r,...s}=n,o=ce(pe,n.__scopeScrollArea),[i,a]=p.useState(),l=p.useRef(null),c=oe(e,l,o.onScrollbarYChange);return p.useEffect(()=>{l.current&&a(getComputedStyle(l.current))},[l]),m.jsx(us,{"data-orientation":"vertical",...s,ref:c,sizes:t,style:{top:0,right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Ct(t)+"px",...n.style},onThumbPointerDown:u=>n.onThumbPointerDown(u.y),onDragScroll:u=>n.onDragScroll(u.y),onWheelScroll:(u,h)=>{if(o.viewport){const d=o.viewport.scrollTop+u.deltaY;n.onWheelScroll(d),ms(d,h)&&u.preventDefault()}},onResize:()=>{l.current&&o.viewport&&i&&r({content:o.viewport.scrollHeight,viewport:o.viewport.offsetHeight,scrollbar:{size:l.current.clientHeight,paddingStart:Et(i.paddingTop),paddingEnd:Et(i.paddingBottom)}})}})}),[ml,cs]=ss(pe),us=p.forwardRef((n,e)=>{const{__scopeScrollArea:t,sizes:r,hasThumb:s,onThumbChange:o,onThumbPointerUp:i,onThumbPointerDown:a,onThumbPositionChange:l,onDragScroll:c,onWheelScroll:u,onResize:h,...d}=n,f=ce(pe,t),[v,g]=p.useState(null),y=oe(e,P=>g(P)),S=p.useRef(null),b=p.useRef(""),_=f.viewport,k=r.content-r.viewport,E=ee(u),A=ee(l),$=Tt(h,10);function O(P){if(S.current){const U=P.clientX-S.current.left,G=P.clientY-S.current.top;c({x:U,y:G})}}return p.useEffect(()=>{const P=U=>{const G=U.target;(v==null?void 0:v.contains(G))&&E(U,k)};return document.addEventListener("wheel",P,{passive:!1}),()=>document.removeEventListener("wheel",P,{passive:!1})},[_,v,k,E]),p.useEffect(A,[r,A]),We(v,$),We(f.content,$),m.jsx(ml,{scope:t,scrollbar:v,hasThumb:s,onThumbChange:ee(o),onThumbPointerUp:ee(i),onThumbPositionChange:A,onThumbPointerDown:ee(a),children:m.jsx(te.div,{...d,ref:y,style:{position:"absolute",...d.style},onPointerDown:Q(n.onPointerDown,P=>{P.button===0&&(P.target.setPointerCapture(P.pointerId),S.current=v.getBoundingClientRect(),b.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",f.viewport&&(f.viewport.style.scrollBehavior="auto"),O(P))}),onPointerMove:Q(n.onPointerMove,O),onPointerUp:Q(n.onPointerUp,P=>{const U=P.target;U.hasPointerCapture(P.pointerId)&&U.releasePointerCapture(P.pointerId),document.body.style.webkitUserSelect=b.current,f.viewport&&(f.viewport.style.scrollBehavior=""),S.current=null})})})}),St="ScrollAreaThumb",ds=p.forwardRef((n,e)=>{const{forceMount:t,...r}=n,s=cs(St,n.__scopeScrollArea);return m.jsx(_e,{present:t||s.hasThumb,children:m.jsx(vl,{ref:e,...r})})}),vl=p.forwardRef((n,e)=>{const{__scopeScrollArea:t,style:r,...s}=n,o=ce(St,t),i=cs(St,t),{onThumbPositionChange:a}=i,l=oe(e,h=>i.onThumbChange(h)),c=p.useRef(),u=Tt(()=>{c.current&&(c.current(),c.current=void 0)},100);return p.useEffect(()=>{const h=o.viewport;if(h){const d=()=>{if(u(),!c.current){const f=wl(h,a);c.current=f,a()}};return a(),h.addEventListener("scroll",d),()=>h.removeEventListener("scroll",d)}},[o.viewport,u,a]),m.jsx(te.div,{"data-state":i.hasThumb?"visible":"hidden",...s,ref:l,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...r},onPointerDownCapture:Q(n.onPointerDownCapture,h=>{const f=h.target.getBoundingClientRect(),v=h.clientX-f.left,g=h.clientY-f.top;i.onThumbPointerDown({x:v,y:g})}),onPointerUp:Q(n.onPointerUp,i.onThumbPointerUp)})});ds.displayName=St;var mr="ScrollAreaCorner",hs=p.forwardRef((n,e)=>{const t=ce(mr,n.__scopeScrollArea),r=!!(t.scrollbarX&&t.scrollbarY);return t.type!=="scroll"&&r?m.jsx(bl,{...n,ref:e}):null});hs.displayName=mr;var bl=p.forwardRef((n,e)=>{const{__scopeScrollArea:t,...r}=n,s=ce(mr,t),[o,i]=p.useState(0),[a,l]=p.useState(0),c=!!(o&&a);return We(s.scrollbarX,()=>{var h;const u=((h=s.scrollbarX)==null?void 0:h.offsetHeight)||0;s.onCornerHeightChange(u),l(u)}),We(s.scrollbarY,()=>{var h;const u=((h=s.scrollbarY)==null?void 0:h.offsetWidth)||0;s.onCornerWidthChange(u),i(u)}),c?m.jsx(te.div,{...r,ref:e,style:{width:o,height:a,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...n.style}}):null});function Et(n){return n?parseInt(n,10):0}function fs(n,e){const t=n/e;return isNaN(t)?0:t}function Ct(n){const e=fs(n.viewport,n.content),t=n.scrollbar.paddingStart+n.scrollbar.paddingEnd,r=(n.scrollbar.size-t)*e;return Math.max(r,18)}function yl(n,e,t,r="ltr"){const s=Ct(t),o=s/2,i=e||o,a=s-i,l=t.scrollbar.paddingStart+i,c=t.scrollbar.size-t.scrollbar.paddingEnd-a,u=t.content-t.viewport,h=r==="ltr"?[0,u]:[u*-1,0];return gs([l,c],h)(n)}function ps(n,e,t="ltr"){const r=Ct(e),s=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,o=e.scrollbar.size-s,i=e.content-e.viewport,a=o-r,l=t==="ltr"?[0,i]:[i*-1,0],c=cl(n,l);return gs([0,i],[0,a])(c)}function gs(n,e){return t=>{if(n[0]===n[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(n[1]-n[0]);return e[0]+r*(t-n[0])}}function ms(n,e){return n>0&&n<e}var wl=(n,e=()=>{})=>{let t={left:n.scrollLeft,top:n.scrollTop},r=0;return function s(){const o={left:n.scrollLeft,top:n.scrollTop},i=t.left!==o.left,a=t.top!==o.top;(i||a)&&e(),t=o,r=window.requestAnimationFrame(s)}(),()=>window.cancelAnimationFrame(r)};function Tt(n,e){const t=ee(n),r=p.useRef(0);return p.useEffect(()=>()=>window.clearTimeout(r.current),[]),p.useCallback(()=>{window.clearTimeout(r.current),r.current=window.setTimeout(t,e)},[t,e])}function We(n,e){const t=ee(e);et(()=>{let r=0;if(n){const s=new ResizeObserver(()=>{cancelAnimationFrame(r),r=window.requestAnimationFrame(t)});return s.observe(n),()=>{window.cancelAnimationFrame(r),s.unobserve(n)}}},[n,t])}function _l(n,e){const{asChild:t,children:r}=n;if(!t)return typeof e=="function"?e(r):e;const s=p.Children.only(r);return p.cloneElement(s,{children:typeof e=="function"?e(s.props.children):e})}var vs=os,kl=as,xl=hs;const bs=p.forwardRef(({className:n,children:e,...t},r)=>m.jsxs(vs,{ref:r,className:Se("relative overflow-hidden",n),...t,children:[m.jsx(kl,{className:"h-full w-full rounded-[inherit]",children:e}),m.jsx(ys,{}),m.jsx(xl,{})]}));bs.displayName=vs.displayName;const ys=p.forwardRef(({className:n,orientation:e="vertical",...t},r)=>m.jsx(pr,{ref:r,orientation:e,className:Se("flex touch-none select-none transition-colors",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",n),...t,children:m.jsx(ds,{className:"relative flex-1 rounded-full bg-border"})}));ys.displayName=pr.displayName;function vr(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let je=vr();function ws(n){je=n}const _s=/[&<>"']/,Sl=new RegExp(_s.source,"g"),ks=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,El=new RegExp(ks.source,"g"),Cl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},xs=n=>Cl[n];function ie(n,e){if(e){if(_s.test(n))return n.replace(Sl,xs)}else if(ks.test(n))return n.replace(El,xs);return n}const Tl=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function Al(n){return n.replace(Tl,(e,t)=>(t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}const Pl=/(^|[^\[])\^/g;function z(n,e){n=typeof n=="string"?n:n.source,e=e||"";const t={replace:(r,s)=>(s=typeof s=="object"&&"source"in s?s.source:s,s=s.replace(Pl,"$1"),n=n.replace(r,s),t),getRegex:()=>new RegExp(n,e)};return t}function Ss(n){try{n=encodeURI(n).replace(/%25/g,"%")}catch{return null}return n}const At={exec:()=>null};function Es(n,e){const t=n.replace(/\|/g,(o,i,a)=>{let l=!1,c=i;for(;--c>=0&&a[c]==="\\";)l=!l;return l?"|":" |"}),r=t.split(/ \|/);let s=0;if(r[0].trim()||r.shift(),r.length>0&&!r[r.length-1].trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;s<r.length;s++)r[s]=r[s].trim().replace(/\\\|/g,"|");return r}function Pt(n,e,t){const r=n.length;if(r===0)return"";let s=0;for(;s<r;){const o=n.charAt(r-s-1);if(o===e&&!t)s++;else if(o!==e&&t)s++;else break}return n.slice(0,r-s)}function $l(n,e){if(n.indexOf(e[1])===-1)return-1;let t=0;for(let r=0;r<n.length;r++)if(n[r]==="\\")r++;else if(n[r]===e[0])t++;else if(n[r]===e[1]&&(t--,t<0))return r;return-1}function Cs(n,e,t,r){const s=e.href,o=e.title?ie(e.title):null,i=n[1].replace(/\\([\[\]])/g,"$1");if(n[0].charAt(0)!=="!"){r.state.inLink=!0;const a={type:"link",raw:t,href:s,title:o,text:i,tokens:r.inlineTokens(i)};return r.state.inLink=!1,a}return{type:"image",raw:t,href:s,title:o,text:ie(i)}}function jl(n,e){const t=n.match(/^(\s+)(?:```)/);if(t===null)return e;const r=t[1];return e.split(`
`).map(s=>{const o=s.match(/^\s+/);if(o===null)return s;const[i]=o;return i.length>=r.length?s.slice(r.length):s}).join(`
`)}class $t{constructor(e){F(this,"options");F(this,"rules");F(this,"lexer");this.options=e||je}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const r=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?r:Pt(r,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const r=t[0],s=jl(r,t[3]||"");return{type:"code",raw:r,lang:t[2]?t[2].trim().replace(this.rules.inline._escapes,"$1"):t[2],text:s}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let r=t[2].trim();if(/#$/.test(r)){const s=Pt(r,"#");(this.options.pedantic||!s||/ $/.test(s))&&(r=s.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){const r=Pt(t[0].replace(/^ *>[ \t]?/gm,""),`
`),s=this.lexer.state.top;this.lexer.state.top=!0;const o=this.lexer.blockTokens(r);return this.lexer.state.top=s,{type:"blockquote",raw:t[0],tokens:o,text:r}}}list(e){let t=this.rules.block.list.exec(e);if(t){let r=t[1].trim();const s=r.length>1,o={type:"list",raw:"",ordered:s,start:s?+r.slice(0,-1):"",loose:!1,items:[]};r=s?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=s?r:"[*+-]");const i=new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`);let a="",l="",c=!1;for(;e;){let u=!1;if(!(t=i.exec(e))||this.rules.block.hr.test(e))break;a=t[0],e=e.substring(a.length);let h=t[2].split(`
`,1)[0].replace(/^\t+/,S=>" ".repeat(3*S.length)),d=e.split(`
`,1)[0],f=0;this.options.pedantic?(f=2,l=h.trimStart()):(f=t[2].search(/[^ ]/),f=f>4?1:f,l=h.slice(f),f+=t[1].length);let v=!1;if(!h&&/^ *$/.test(d)&&(a+=d+`
`,e=e.substring(d.length+1),u=!0),!u){const S=new RegExp(`^ {0,${Math.min(3,f-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),b=new RegExp(`^ {0,${Math.min(3,f-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),_=new RegExp(`^ {0,${Math.min(3,f-1)}}(?:\`\`\`|~~~)`),k=new RegExp(`^ {0,${Math.min(3,f-1)}}#`);for(;e;){const E=e.split(`
`,1)[0];if(d=E,this.options.pedantic&&(d=d.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),_.test(d)||k.test(d)||S.test(d)||b.test(e))break;if(d.search(/[^ ]/)>=f||!d.trim())l+=`
`+d.slice(f);else{if(v||h.search(/[^ ]/)>=4||_.test(h)||k.test(h)||b.test(h))break;l+=`
`+d}!v&&!d.trim()&&(v=!0),a+=E+`
`,e=e.substring(E.length+1),h=d.slice(f)}}o.loose||(c?o.loose=!0:/\n *\n *$/.test(a)&&(c=!0));let g=null,y;this.options.gfm&&(g=/^\[[ xX]\] /.exec(l),g&&(y=g[0]!=="[ ] ",l=l.replace(/^\[[ xX]\] +/,""))),o.items.push({type:"list_item",raw:a,task:!!g,checked:y,loose:!1,text:l,tokens:[]}),o.raw+=a}o.items[o.items.length-1].raw=a.trimEnd(),o.items[o.items.length-1].text=l.trimEnd(),o.raw=o.raw.trimEnd();for(let u=0;u<o.items.length;u++)if(this.lexer.state.top=!1,o.items[u].tokens=this.lexer.blockTokens(o.items[u].text,[]),!o.loose){const h=o.items[u].tokens.filter(f=>f.type==="space"),d=h.length>0&&h.some(f=>/\n.*\n/.test(f.raw));o.loose=d}if(o.loose)for(let u=0;u<o.items.length;u++)o.items[u].loose=!0;return o}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const r=t[1].toLowerCase().replace(/\s+/g," "),s=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",o=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline._escapes,"$1"):t[3];return{type:"def",tag:r,raw:t[0],href:s,title:o}}}table(e){const t=this.rules.block.table.exec(e);if(t){if(!/[:|]/.test(t[2]))return;const r={type:"table",raw:t[0],header:Es(t[1]).map(s=>({text:s,tokens:[]})),align:t[2].replace(/^\||\| *$/g,"").split("|"),rows:t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(r.header.length===r.align.length){let s=r.align.length,o,i,a,l;for(o=0;o<s;o++){const c=r.align[o];c&&(/^ *-+: *$/.test(c)?r.align[o]="right":/^ *:-+: *$/.test(c)?r.align[o]="center":/^ *:-+ *$/.test(c)?r.align[o]="left":r.align[o]=null)}for(s=r.rows.length,o=0;o<s;o++)r.rows[o]=Es(r.rows[o],r.header.length).map(c=>({text:c,tokens:[]}));for(s=r.header.length,i=0;i<s;i++)r.header[i].tokens=this.lexer.inline(r.header[i].text);for(s=r.rows.length,i=0;i<s;i++)for(l=r.rows[i],a=0;a<l.length;a++)l[a].tokens=this.lexer.inline(l[a].text);return r}}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const r=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:r,tokens:this.lexer.inline(r)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:ie(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const r=t[2].trim();if(!this.options.pedantic&&/^</.test(r)){if(!/>$/.test(r))return;const i=Pt(r.slice(0,-1),"\\");if((r.length-i.length)%2===0)return}else{const i=$l(t[2],"()");if(i>-1){const l=(t[0].indexOf("!")===0?5:4)+t[1].length+i;t[2]=t[2].substring(0,i),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let s=t[2],o="";if(this.options.pedantic){const i=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(s);i&&(s=i[1],o=i[3])}else o=t[3]?t[3].slice(1,-1):"";return s=s.trim(),/^</.test(s)&&(this.options.pedantic&&!/>$/.test(r)?s=s.slice(1):s=s.slice(1,-1)),Cs(t,{href:s&&s.replace(this.rules.inline._escapes,"$1"),title:o&&o.replace(this.rules.inline._escapes,"$1")},t[0],this.lexer)}}reflink(e,t){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){let s=(r[2]||r[1]).replace(/\s+/g," ");if(s=t[s.toLowerCase()],!s){const o=r[0].charAt(0);return{type:"text",raw:o,text:o}}return Cs(r,s,r[0],this.lexer)}}emStrong(e,t,r=""){let s=this.rules.inline.emStrong.lDelim.exec(e);if(!s||s[3]&&r.match(/[\p{L}\p{N}]/u))return;if(!(s[1]||s[2]||"")||!r||this.rules.inline.punctuation.exec(r)){const i=[...s[0]].length-1;let a,l,c=i,u=0;const h=s[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(h.lastIndex=0,t=t.slice(-1*e.length+s[0].length-1);(s=h.exec(t))!=null;){if(a=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!a)continue;if(l=[...a].length,s[3]||s[4]){c+=l;continue}else if((s[5]||s[6])&&i%3&&!((i+l)%3)){u+=l;continue}if(c-=l,c>0)continue;l=Math.min(l,l+c+u);const d=[...e].slice(0,i+s.index+l+1).join("");if(Math.min(i,l)%2){const v=d.slice(1,-1);return{type:"em",raw:d,text:v,tokens:this.lexer.inlineTokens(v)}}const f=d.slice(2,-2);return{type:"strong",raw:d,text:f,tokens:this.lexer.inlineTokens(f)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let r=t[2].replace(/\n/g," ");const s=/[^ ]/.test(r),o=/^ /.test(r)&&/ $/.test(r);return s&&o&&(r=r.substring(1,r.length-1)),r=ie(r,!0),{type:"codespan",raw:t[0],text:r}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let r,s;return t[2]==="@"?(r=ie(t[1]),s="mailto:"+r):(r=ie(t[1]),s=r),{type:"link",raw:t[0],text:r,href:s,tokens:[{type:"text",raw:r,text:r}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let r,s;if(t[2]==="@")r=ie(t[0]),s="mailto:"+r;else{let o;do o=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])[0];while(o!==t[0]);r=ie(t[0]),t[1]==="www."?s="http://"+t[0]:s=t[0]}return{type:"link",raw:t[0],text:r,href:s,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){let r;return this.lexer.state.inRawBlock?r=t[0]:r=ie(t[0]),{type:"text",raw:t[0],text:r}}}}const j={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:At,lheading:/^(?!bull )((?:.|\n(?!\s*?\n|bull ))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};j._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/,j._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/,j.def=z(j.def).replace("label",j._label).replace("title",j._title).getRegex(),j.bullet=/(?:[*+-]|\d{1,9}[.)])/,j.listItemStart=z(/^( *)(bull) */).replace("bull",j.bullet).getRegex(),j.list=z(j.list).replace(/bull/g,j.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+j.def.source+")").getRegex(),j._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",j._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,j.html=z(j.html,"i").replace("comment",j._comment).replace("tag",j._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),j.lheading=z(j.lheading).replace(/bull/g,j.bullet).getRegex(),j.paragraph=z(j._paragraph).replace("hr",j.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",j._tag).getRegex(),j.blockquote=z(j.blockquote).replace("paragraph",j.paragraph).getRegex(),j.normal={...j},j.gfm={...j.normal,table:"^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"},j.gfm.table=z(j.gfm.table).replace("hr",j.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",j._tag).getRegex(),j.gfm.paragraph=z(j._paragraph).replace("hr",j.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",j.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",j._tag).getRegex(),j.pedantic={...j.normal,html:z(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",j._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:At,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:z(j.normal._paragraph).replace("hr",j.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",j.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};const T={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:At,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,rDelimAst:/^[^_*]*?__[^_*]*?\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\*)[punct](\*+)(?=[\s]|$)|[^punct\s](\*+)(?!\*)(?=[punct\s]|$)|(?!\*)[punct\s](\*+)(?=[^punct\s])|[\s](\*+)(?!\*)(?=[punct])|(?!\*)[punct](\*+)(?!\*)(?=[punct])|[^punct\s](\*+)(?=[^punct\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?_[^_*]*?(?=\*\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\s]|$)|[^punct\s](_+)(?!_)(?=[punct\s]|$)|(?!_)[punct\s](_+)(?=[^punct\s])|[\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:At,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^((?![*_])[\spunctuation])/};T._punctuation="\\p{P}$+<=>`^|~",T.punctuation=z(T.punctuation,"u").replace(/punctuation/g,T._punctuation).getRegex(),T.blockSkip=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,T.anyPunctuation=/\\[punct]/g,T._escapes=/\\([punct])/g,T._comment=z(j._comment).replace("(?:-->|$)","-->").getRegex(),T.emStrong.lDelim=z(T.emStrong.lDelim,"u").replace(/punct/g,T._punctuation).getRegex(),T.emStrong.rDelimAst=z(T.emStrong.rDelimAst,"gu").replace(/punct/g,T._punctuation).getRegex(),T.emStrong.rDelimUnd=z(T.emStrong.rDelimUnd,"gu").replace(/punct/g,T._punctuation).getRegex(),T.anyPunctuation=z(T.anyPunctuation,"gu").replace(/punct/g,T._punctuation).getRegex(),T._escapes=z(T._escapes,"gu").replace(/punct/g,T._punctuation).getRegex(),T._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,T._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,T.autolink=z(T.autolink).replace("scheme",T._scheme).replace("email",T._email).getRegex(),T._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,T.tag=z(T.tag).replace("comment",T._comment).replace("attribute",T._attribute).getRegex(),T._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,T._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/,T._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,T.link=z(T.link).replace("label",T._label).replace("href",T._href).replace("title",T._title).getRegex(),T.reflink=z(T.reflink).replace("label",T._label).replace("ref",j._label).getRegex(),T.nolink=z(T.nolink).replace("ref",j._label).getRegex(),T.reflinkSearch=z(T.reflinkSearch,"g").replace("reflink",T.reflink).replace("nolink",T.nolink).getRegex(),T.normal={...T},T.pedantic={...T.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:z(/^!?\[(label)\]\((.*?)\)/).replace("label",T._label).getRegex(),reflink:z(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",T._label).getRegex()},T.gfm={...T.normal,escape:z(T.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},T.gfm.url=z(T.gfm.url,"i").replace("email",T.gfm._extended_email).getRegex(),T.breaks={...T.gfm,br:z(T.br).replace("{2,}","*").getRegex(),text:z(T.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};class ge{constructor(e){F(this,"tokens");F(this,"options");F(this,"state");F(this,"tokenizer");F(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||je,this.options.tokenizer=this.options.tokenizer||new $t,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:j.normal,inline:T.normal};this.options.pedantic?(t.block=j.pedantic,t.inline=T.pedantic):this.options.gfm&&(t.block=j.gfm,this.options.breaks?t.inline=T.breaks:t.inline=T.gfm),this.tokenizer.rules=t}static get rules(){return{block:j,inline:T}}static lex(e,t){return new ge(t).lex(e)}static lexInline(e,t){return new ge(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);let t;for(;t=this.inlineQueue.shift();)this.inlineTokens(t.src,t.tokens);return this.tokens}blockTokens(e,t=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(a,l,c)=>l+"    ".repeat(c.length));let r,s,o,i;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>(r=a.call({lexer:this},e,t))?(e=e.substring(r.raw.length),t.push(r),!0):!1))){if(r=this.tokenizer.space(e)){e=e.substring(r.raw.length),r.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(r);continue}if(r=this.tokenizer.code(e)){e=e.substring(r.raw.length),s=t[t.length-1],s&&(s.type==="paragraph"||s.type==="text")?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(r);continue}if(r=this.tokenizer.fences(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.heading(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.hr(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.blockquote(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.list(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.html(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.def(e)){e=e.substring(r.raw.length),s=t[t.length-1],s&&(s.type==="paragraph"||s.type==="text")?(s.raw+=`
`+r.raw,s.text+=`
`+r.raw,this.inlineQueue[this.inlineQueue.length-1].src=s.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title});continue}if(r=this.tokenizer.table(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.lheading(e)){e=e.substring(r.raw.length),t.push(r);continue}if(o=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0;const l=e.slice(1);let c;this.options.extensions.startBlock.forEach(u=>{c=u.call({lexer:this},l),typeof c=="number"&&c>=0&&(a=Math.min(a,c))}),a<1/0&&a>=0&&(o=e.substring(0,a+1))}if(this.state.top&&(r=this.tokenizer.paragraph(o))){s=t[t.length-1],i&&s.type==="paragraph"?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(r),i=o.length!==e.length,e=e.substring(r.raw.length);continue}if(r=this.tokenizer.text(e)){e=e.substring(r.raw.length),s=t[t.length-1],s&&s.type==="text"?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(r);continue}if(e){const a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let r,s,o,i=e,a,l,c;if(this.tokens.links){const u=Object.keys(this.tokens.links);if(u.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(i))!=null;)u.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(i=i.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.blockSkip.exec(i))!=null;)i=i.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(i))!=null;)i=i.slice(0,a.index)+"++"+i.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(l||(c=""),l=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(u=>(r=u.call({lexer:this},e,t))?(e=e.substring(r.raw.length),t.push(r),!0):!1))){if(r=this.tokenizer.escape(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.tag(e)){e=e.substring(r.raw.length),s=t[t.length-1],s&&r.type==="text"&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):t.push(r);continue}if(r=this.tokenizer.link(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(r.raw.length),s=t[t.length-1],s&&r.type==="text"&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):t.push(r);continue}if(r=this.tokenizer.emStrong(e,i,c)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.codespan(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.br(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.del(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.autolink(e)){e=e.substring(r.raw.length),t.push(r);continue}if(!this.state.inLink&&(r=this.tokenizer.url(e))){e=e.substring(r.raw.length),t.push(r);continue}if(o=e,this.options.extensions&&this.options.extensions.startInline){let u=1/0;const h=e.slice(1);let d;this.options.extensions.startInline.forEach(f=>{d=f.call({lexer:this},h),typeof d=="number"&&d>=0&&(u=Math.min(u,d))}),u<1/0&&u>=0&&(o=e.substring(0,u+1))}if(r=this.tokenizer.inlineText(o)){e=e.substring(r.raw.length),r.raw.slice(-1)!=="_"&&(c=r.raw.slice(-1)),l=!0,s=t[t.length-1],s&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):t.push(r);continue}if(e){const u="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(u);break}else throw new Error(u)}}return t}}class jt{constructor(e){F(this,"options");this.options=e||je}code(e,t,r){var o;const s=(o=(t||"").match(/^\S*/))==null?void 0:o[0];return e=e.replace(/\n$/,"")+`
`,s?'<pre><code class="language-'+ie(s)+'">'+(r?e:ie(e,!0))+`</code></pre>
`:"<pre><code>"+(r?e:ie(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e,t){return e}heading(e,t,r){return`<h${t}>${e}</h${t}>
`}hr(){return`<hr>
`}list(e,t,r){const s=t?"ol":"ul",o=t&&r!==1?' start="'+r+'"':"";return"<"+s+o+`>
`+e+"</"+s+`>
`}listitem(e,t,r){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(e){return`<p>${e}</p>
`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+t+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,t){const r=t.header?"th":"td";return(t.align?`<${r} align="${t.align}">`:`<${r}>`)+e+`</${r}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return"<br>"}del(e){return`<del>${e}</del>`}link(e,t,r){const s=Ss(e);if(s===null)return r;e=s;let o='<a href="'+e+'"';return t&&(o+=' title="'+t+'"'),o+=">"+r+"</a>",o}image(e,t,r){const s=Ss(e);if(s===null)return r;e=s;let o=`<img src="${e}" alt="${r}"`;return t&&(o+=` title="${t}"`),o+=">",o}text(e){return e}}class br{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,r){return""+r}image(e,t,r){return""+r}br(){return""}}class me{constructor(e){F(this,"options");F(this,"renderer");F(this,"textRenderer");this.options=e||je,this.options.renderer=this.options.renderer||new jt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new br}static parse(e,t){return new me(t).parse(e)}static parseInline(e,t){return new me(t).parseInline(e)}parse(e,t=!0){let r="";for(let s=0;s<e.length;s++){const o=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[o.type]){const i=o,a=this.options.extensions.renderers[i.type].call({parser:this},i);if(a!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(i.type)){r+=a||"";continue}}switch(o.type){case"space":continue;case"hr":{r+=this.renderer.hr();continue}case"heading":{const i=o;r+=this.renderer.heading(this.parseInline(i.tokens),i.depth,Al(this.parseInline(i.tokens,this.textRenderer)));continue}case"code":{const i=o;r+=this.renderer.code(i.text,i.lang,!!i.escaped);continue}case"table":{const i=o;let a="",l="";for(let u=0;u<i.header.length;u++)l+=this.renderer.tablecell(this.parseInline(i.header[u].tokens),{header:!0,align:i.align[u]});a+=this.renderer.tablerow(l);let c="";for(let u=0;u<i.rows.length;u++){const h=i.rows[u];l="";for(let d=0;d<h.length;d++)l+=this.renderer.tablecell(this.parseInline(h[d].tokens),{header:!1,align:i.align[d]});c+=this.renderer.tablerow(l)}r+=this.renderer.table(a,c);continue}case"blockquote":{const i=o,a=this.parse(i.tokens);r+=this.renderer.blockquote(a);continue}case"list":{const i=o,a=i.ordered,l=i.start,c=i.loose;let u="";for(let h=0;h<i.items.length;h++){const d=i.items[h],f=d.checked,v=d.task;let g="";if(d.task){const y=this.renderer.checkbox(!!f);c?d.tokens.length>0&&d.tokens[0].type==="paragraph"?(d.tokens[0].text=y+" "+d.tokens[0].text,d.tokens[0].tokens&&d.tokens[0].tokens.length>0&&d.tokens[0].tokens[0].type==="text"&&(d.tokens[0].tokens[0].text=y+" "+d.tokens[0].tokens[0].text)):d.tokens.unshift({type:"text",text:y+" "}):g+=y+" "}g+=this.parse(d.tokens,c),u+=this.renderer.listitem(g,v,!!f)}r+=this.renderer.list(u,a,l);continue}case"html":{const i=o;r+=this.renderer.html(i.text,i.block);continue}case"paragraph":{const i=o;r+=this.renderer.paragraph(this.parseInline(i.tokens));continue}case"text":{let i=o,a=i.tokens?this.parseInline(i.tokens):i.text;for(;s+1<e.length&&e[s+1].type==="text";)i=e[++s],a+=`
`+(i.tokens?this.parseInline(i.tokens):i.text);r+=t?this.renderer.paragraph(a):a;continue}default:{const i='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return r}parseInline(e,t){t=t||this.renderer;let r="";for(let s=0;s<e.length;s++){const o=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[o.type]){const i=this.options.extensions.renderers[o.type].call({parser:this},o);if(i!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){r+=i||"";continue}}switch(o.type){case"escape":{const i=o;r+=t.text(i.text);break}case"html":{const i=o;r+=t.html(i.text);break}case"link":{const i=o;r+=t.link(i.href,i.title,this.parseInline(i.tokens,t));break}case"image":{const i=o;r+=t.image(i.href,i.title,i.text);break}case"strong":{const i=o;r+=t.strong(this.parseInline(i.tokens,t));break}case"em":{const i=o;r+=t.em(this.parseInline(i.tokens,t));break}case"codespan":{const i=o;r+=t.codespan(i.text);break}case"br":{r+=t.br();break}case"del":{const i=o;r+=t.del(this.parseInline(i.tokens,t));break}case"text":{const i=o;r+=t.text(i.text);break}default:{const i='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return r}}class nt{constructor(e){F(this,"options");this.options=e||je}preprocess(e){return e}postprocess(e){return e}}F(nt,"passThroughHooks",new Set(["preprocess","postprocess"]));class Rl{constructor(...e){yo(this,Ne);F(this,"defaults",vr());F(this,"options",this.setOptions);F(this,"parse",Vt(this,Ne,Wr).call(this,ge.lex,me.parse));F(this,"parseInline",Vt(this,Ne,Wr).call(this,ge.lexInline,me.parseInline));F(this,"Parser",me);F(this,"parser",me.parse);F(this,"Renderer",jt);F(this,"TextRenderer",br);F(this,"Lexer",ge);F(this,"lexer",ge.lex);F(this,"Tokenizer",$t);F(this,"Hooks",nt);this.use(...e)}walkTokens(e,t){var s,o;let r=[];for(const i of e)switch(r=r.concat(t.call(this,i)),i.type){case"table":{const a=i;for(const l of a.header)r=r.concat(this.walkTokens(l.tokens,t));for(const l of a.rows)for(const c of l)r=r.concat(this.walkTokens(c.tokens,t));break}case"list":{const a=i;r=r.concat(this.walkTokens(a.items,t));break}default:{const a=i;(o=(s=this.defaults.extensions)==null?void 0:s.childTokens)!=null&&o[a.type]?this.defaults.extensions.childTokens[a.type].forEach(l=>{r=r.concat(this.walkTokens(a[l],t))}):a.tokens&&(r=r.concat(this.walkTokens(a.tokens,t)))}}return r}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(r=>{const s={...r};if(s.async=this.defaults.async||s.async||!1,r.extensions&&(r.extensions.forEach(o=>{if(!o.name)throw new Error("extension name required");if("renderer"in o){const i=t.renderers[o.name];i?t.renderers[o.name]=function(...a){let l=o.renderer.apply(this,a);return l===!1&&(l=i.apply(this,a)),l}:t.renderers[o.name]=o.renderer}if("tokenizer"in o){if(!o.level||o.level!=="block"&&o.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const i=t[o.level];i?i.unshift(o.tokenizer):t[o.level]=[o.tokenizer],o.start&&(o.level==="block"?t.startBlock?t.startBlock.push(o.start):t.startBlock=[o.start]:o.level==="inline"&&(t.startInline?t.startInline.push(o.start):t.startInline=[o.start]))}"childTokens"in o&&o.childTokens&&(t.childTokens[o.name]=o.childTokens)}),s.extensions=t),r.renderer){const o=this.defaults.renderer||new jt(this.defaults);for(const i in r.renderer){const a=r.renderer[i],l=i,c=o[l];o[l]=(...u)=>{let h=a.apply(o,u);return h===!1&&(h=c.apply(o,u)),h||""}}s.renderer=o}if(r.tokenizer){const o=this.defaults.tokenizer||new $t(this.defaults);for(const i in r.tokenizer){const a=r.tokenizer[i],l=i,c=o[l];o[l]=(...u)=>{let h=a.apply(o,u);return h===!1&&(h=c.apply(o,u)),h}}s.tokenizer=o}if(r.hooks){const o=this.defaults.hooks||new nt;for(const i in r.hooks){const a=r.hooks[i],l=i,c=o[l];nt.passThroughHooks.has(i)?o[l]=u=>{if(this.defaults.async)return Promise.resolve(a.call(o,u)).then(d=>c.call(o,d));const h=a.call(o,u);return c.call(o,h)}:o[l]=(...u)=>{let h=a.apply(o,u);return h===!1&&(h=c.apply(o,u)),h}}s.hooks=o}if(r.walkTokens){const o=this.defaults.walkTokens,i=r.walkTokens;s.walkTokens=function(a){let l=[];return l.push(i.call(this,a)),o&&(l=l.concat(o.call(this,a))),l}}this.defaults={...this.defaults,...s}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}}Ne=new WeakSet,Wr=function(e,t){return(r,s)=>{const o={...s},i={...this.defaults,...o};this.defaults.async===!0&&o.async===!1&&(i.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),i.async=!0);const a=Vt(this,Ne,wo).call(this,!!i.silent,!!i.async);if(typeof r>"u"||r===null)return a(new Error("marked(): input parameter is undefined or null"));if(typeof r!="string")return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(r)+", string expected"));if(i.hooks&&(i.hooks.options=i),i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(r):r).then(l=>e(l,i)).then(l=>i.walkTokens?Promise.all(this.walkTokens(l,i.walkTokens)).then(()=>l):l).then(l=>t(l,i)).then(l=>i.hooks?i.hooks.postprocess(l):l).catch(a);try{i.hooks&&(r=i.hooks.preprocess(r));const l=e(r,i);i.walkTokens&&this.walkTokens(l,i.walkTokens);let c=t(l,i);return i.hooks&&(c=i.hooks.postprocess(c)),c}catch(l){return a(l)}}},wo=function(e,t){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const s="<p>An error occurred:</p><pre>"+ie(r.message+"",!0)+"</pre>";return t?Promise.resolve(s):s}if(t)return Promise.reject(r);throw r}};const Re=new Rl;function B(n,e){return Re.parse(n,e)}B.options=B.setOptions=function(n){return Re.setOptions(n),B.defaults=Re.defaults,ws(B.defaults),B},B.getDefaults=vr,B.defaults=je,B.use=function(...n){return Re.use(...n),B.defaults=Re.defaults,ws(B.defaults),B},B.walkTokens=function(n,e){return Re.walkTokens(n,e)},B.parseInline=Re.parseInline,B.Parser=me,B.parser=me.parse,B.Renderer=jt,B.TextRenderer=br,B.Lexer=ge,B.lexer=ge.lex,B.Tokenizer=$t,B.Hooks=nt,B.parse=B,B.options,B.setOptions,B.use,B.walkTokens,B.parseInline,me.parse,ge.lex;const Ts=({content:n,isUser:e})=>{const t=()=>{if(!n)return{__html:""};try{return{__html:B(n)}}catch(r){return console.error("Error parsing markdown:",r),{__html:n}}};return m.jsx("div",{className:Se("flex mb-2",e?"justify-end":"justify-start"),children:m.jsx("div",{className:Se("max-w-[80%] p-3 rounded-lg shadow-sm",e?"bg-blue-600 text-white rounded-tr-none":"bg-gray-800/80 backdrop-blur-sm text-gray-100 rounded-tl-none"),children:n?m.jsx("div",{className:"prose prose-sm prose-invert max-w-none break-words",dangerouslySetInnerHTML:t()}):m.jsx("span",{className:"text-gray-400 italic",children:"Пустое сообщение"})})})},As=()=>m.jsxs("div",{className:"inline-flex gap-1",children:[m.jsx("span",{className:"w-1 h-1 bg-gray-400 rounded-full",style:{animation:"typingDot 1.4s infinite ease-in-out",animationDelay:"0ms"}}),m.jsx("span",{className:"w-1 h-1 bg-gray-400 rounded-full",style:{animation:"typingDot 1.4s infinite ease-in-out",animationDelay:"200ms"}}),m.jsx("span",{className:"w-1 h-1 bg-gray-400 rounded-full",style:{animation:"typingDot 1.4s infinite ease-in-out",animationDelay:"400ms"}}),m.jsx("style",{children:`
      @keyframes typingDot {
        0%, 100% { transform: translateY(0); opacity: 0.5; }
        50% { transform: translateY(-1px); opacity: 1; }
      }
    `})]}),Ol=({messages:n,isLoading:e,isExpanded:t})=>{const r=C.useRef(null),s=C.useRef(null),[o,i]=C.useState(!1),[a,l]=C.useState(!0),c=C.useRef(n.length),u=()=>{a&&s.current&&!o&&s.current.scrollIntoView({behavior:"smooth",block:"end"})},h=d=>{if(!r.current)return;const{scrollTop:f,scrollHeight:v,clientHeight:g}=d.currentTarget,y=Math.abs(v-f-g)<20;l(y),o&&setTimeout(()=>i(!1),150)};return C.useEffect(()=>{const d=document.querySelector("[data-radix-scroll-area-viewport]");if(d){const f=()=>{i(!0)};return d.addEventListener("wheel",f,{passive:!0}),d.addEventListener("touchmove",f,{passive:!0}),()=>{d.removeEventListener("wheel",f),d.removeEventListener("touchmove",f)}}},[]),C.useEffect(()=>{const d=n.length>c.current;if(c.current=n.length,d||e){const f=setTimeout(()=>{u()},200);return()=>clearTimeout(f)}},[n,e]),m.jsx("div",{className:`w-full mb-6 ${t?"flex-grow":"h-48"} overflow-hidden bg-transparent rounded-lg`,children:m.jsx(bs,{className:"h-full pr-4",type:"auto",scrollHideDelay:300,children:m.jsxs("div",{className:"px-2 py-1",ref:r,onScroll:h,children:[n.length===0&&m.jsx("div",{className:"p-3 text-gray-200",children:m.jsx("p",{className:"text-sm",children:"Начните диалог с ассистентом Амика, отправив текстовое или голосовое сообщение."})}),n.map((d,f)=>{var g;const v=d.id||`message-${f}-${Date.now()}-${((g=d.user_query)==null?void 0:g.substring(0,10))||"bot"}`;return m.jsxs("div",{className:"mb-3 animate-fade-in",children:[d.user_query&&m.jsx(Ts,{content:d.user_query,isUser:!0}),d.isLoading?m.jsx("div",{className:"flex justify-start",children:m.jsx("div",{className:"max-w-[80%] bg-gray-800/80 backdrop-blur-sm rounded-lg px-4 py-3 text-gray-100 shadow-md",children:m.jsx(As,{})})}):m.jsx(Ts,{content:d.bot_response,isUser:!1})]},v)}),e&&!n.find(d=>d.isLoading)&&m.jsx("div",{className:"flex justify-start mb-3 animate-fade-in",children:m.jsx("div",{className:"inline-flex items-center bg-gray-800/80 backdrop-blur-sm rounded-lg px-3 py-2 shadow-md",children:m.jsx(As,{})})}),m.jsx("div",{ref:s,className:"h-px"})," "]})})})},Il=({userInput:n,onUserInputChange:e,onSendMessage:t,isLoading:r})=>{const s=o=>{o.key==="Enter"&&t()};return m.jsxs("div",{className:"flex-grow flex items-center gap-2 bg-gray-700/30 rounded-full pl-4 pr-2 py-2 animate-fade-in",children:[m.jsx("input",{type:"text",className:"bg-transparent border-none outline-none text-gray-100 flex-grow text-sm",placeholder:"Напишите сообщение...",value:n,onChange:e,onKeyPress:s,disabled:r}),m.jsx("button",{onClick:t,className:`p-2 ${r?"bg-gray-500":"bg-blue-500 hover:bg-blue-600"} rounded-full transition-colors`,disabled:r,children:r?m.jsx(da,{size:16,className:"text-white animate-spin"}):m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[m.jsx("path",{d:"M22 2L11 13"}),m.jsx("path",{d:"M22 2L15 22L11 13L2 9L22 2Z"})]})})]})},Ll=({isListening:n,isSpeaking:e,voiceVolume:t,transcript:r,onCircleClick:s,isExpanded:o,isInputVisible:i,userInput:a,onUserInputChange:l,onSendMessage:c,messages:u,isLoading:h,createTask:d})=>m.jsxs("div",{className:`flex flex-col items-center justify-between ${o?"h-[80vh]":"h-[500px]"} transition-all duration-300`,children:[m.jsx(il,{isListening:n,isSpeaking:e}),m.jsx(Ol,{messages:u,isLoading:h,isExpanded:o}),m.jsx("div",{className:"w-full flex items-center justify-center mb-4 transition-all duration-300",children:m.jsxs("div",{className:"flex items-center justify-between w-full px-4 gap-4",children:[m.jsx("div",{className:"transition-all duration-300",children:m.jsx(ol,{isListening:n,isSpeaking:e,voiceVolume:t,onClick:s})}),m.jsx(Il,{userInput:a,onUserInputChange:l,onSendMessage:c,isLoading:h})]})})]}),Dl=({isExpanded:n,toggleFullscreen:e,dialogPosition:t,isListening:r,isSpeaking:s,voiceVolume:o,transcript:i,onCircleClick:a,userInput:l,onUserInputChange:c,onSendMessage:u,messages:h,isLoading:d,createTask:f})=>{const v=C.useMemo(()=>{try{return window.self!==window.top}catch{return!0}},[]);return m.jsxs(ts,{className:`sm:max-w-md bg-gradient-to-b from-gray-900 to-gray-800 border-none shadow-2xl animate-fade-in ${n?"fixed inset-0 max-w-full max-h-full rounded-none":"rounded-xl"}`,style:n?{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",width:"100%",height:"100%",maxWidth:"100%",transform:"none",margin:"0",borderRadius:"0"}:{position:"absolute",top:`${Math.max(20,t.top)}px`,left:`${t.left+3}px`,transform:"none",minHeight:"500px",width:"420px",...v?{position:"fixed",top:"20px",right:"20px",left:"auto"}:{}},children:[m.jsx("div",{className:"absolute right-4 top-4 flex items-center gap-2 z-10",children:m.jsx("button",{onClick:e,className:"text-gray-300 hover:text-white transition-colors p-2 bg-gray-800/50 rounded-full",children:n?m.jsx(fa,{size:18}):m.jsx(ha,{size:18})})}),m.jsx(Ll,{isListening:r,isSpeaking:s,voiceVolume:o,transcript:i,onCircleClick:a,isExpanded:n,isInputVisible:!0,userInput:l,onUserInputChange:c,onSendMessage:u,messages:h,isLoading:d,createTask:f})]})},Nl=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(()=>Ve).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class yr extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Ml extends yr{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ul extends yr{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class zl extends yr{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var wr;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(wr||(wr={}));var Fl=function(n,e,t,r){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(u){try{c(r.next(u))}catch(h){i(h)}}function l(u){try{c(r.throw(u))}catch(h){i(h)}}function c(u){u.done?o(u.value):s(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};class Bl{constructor(e,{headers:t={},customFetch:r,region:s=wr.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=Nl(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Fl(this,void 0,void 0,function*(){try{const{headers:s,method:o,body:i}=t;let a={},{region:l}=t;l||(l=this.region),l&&l!=="any"&&(a["x-region"]=l);let c;i&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=i):typeof i=="string"?(a["Content-Type"]="text/plain",c=i):typeof FormData<"u"&&i instanceof FormData?c=i:(a["Content-Type"]="application/json",c=JSON.stringify(i)));const u=yield this.fetch(`${this.url}/${e}`,{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:c}).catch(v=>{throw new Ml(v)}),h=u.headers.get("x-relay-error");if(h&&h==="true")throw new Ul(u);if(!u.ok)throw new zl(u);let d=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),f;return d==="application/json"?f=yield u.json():d==="application/octet-stream"?f=yield u.blob():d==="text/event-stream"?f=u:d==="multipart/form-data"?f=yield u.formData():f=yield u.text(),{data:f,error:null}}catch(s){return{data:null,error:s}}})}}var re={},_r={},Rt={},st={},Ot={},It={},ql=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},He=ql();const Wl=He.fetch,Ps=He.fetch.bind(He),$s=He.Headers,Hl=He.Request,Vl=He.Response,Ve=Object.freeze(Object.defineProperty({__proto__:null,Headers:$s,Request:Hl,Response:Vl,default:Ps,fetch:Wl},Symbol.toStringTag,{value:"Module"})),Gl=So(Ve);var Lt={};Object.defineProperty(Lt,"__esModule",{value:!0});let Jl=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Lt.default=Jl;var js=le&&le.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(It,"__esModule",{value:!0});const Kl=js(Gl),Yl=js(Lt);let Xl=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Kl.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{var i,a,l;let c=null,u=null,h=null,d=o.status,f=o.statusText;if(o.ok){if(this.method!=="HEAD"){const S=await o.text();S===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=S:u=JSON.parse(S))}const g=(i=this.headers.Prefer)===null||i===void 0?void 0:i.match(/count=(exact|planned|estimated)/),y=(a=o.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");g&&y&&y.length>1&&(h=parseInt(y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,d=406,f="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const g=await o.text();try{c=JSON.parse(g),Array.isArray(c)&&o.status===404&&(u=[],c=null,d=200,f="OK")}catch{o.status===404&&g===""?(d=204,f="No Content"):c={message:g}}if(c&&this.isMaybeSingle&&(!((l=c==null?void 0:c.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,d=200,f="OK"),c&&this.shouldThrowOnError)throw new Yl.default(c)}return{error:c,data:u,count:h,status:d,statusText:f}});return this.shouldThrowOnError||(s=s.catch(o=>{var i,a,l;return{error:{message:`${(i=o==null?void 0:o.name)!==null&&i!==void 0?i:"FetchError"}: ${o==null?void 0:o.message}`,details:`${(a=o==null?void 0:o.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=o==null?void 0:o.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};It.default=Xl;var Zl=le&&le.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ot,"__esModule",{value:!0});const Ql=Zl(It);let ec=class extends Ql.default{select(e){let t=!1;const r=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:o=s}={}){const i=o?`${o}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const o=typeof s>"u"?"offset":`${s}.offset`,i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(o,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:o=!1,format:i="text"}={}){var a;const l=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,o?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${i}; for="${c}"; options=${l};`,i==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Ot.default=ec;var tc=le&&le.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(st,"__esModule",{value:!0});const rc=tc(Ot);let nc=class extends rc.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let o="";s==="plain"?o="pl":s==="phrase"?o="ph":s==="websearch"&&(o="w");const i=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${o}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};st.default=nc;var sc=le&&le.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Rt,"__esModule",{value:!0});const ot=sc(st);let oc=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let o=!1;const i=(e??"*").split("").map(a=>/\s/.test(a)&&!o?"":(a==='"'&&(o=!o),a)).join("");return this.url.searchParams.set("select",i),r&&(this.headers.Prefer=`count=${r}`),new ot.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s="POST",o=[];if(this.headers.Prefer&&o.push(this.headers.Prefer),t&&o.push(`count=${t}`),r||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const i=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(i.length>0){const a=[...new Set(i)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new ot.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:o=!0}={}){const i="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),o||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const l=e.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){const c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new ot.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new ot.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new ot.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Rt.default=oc;var Dt={},Nt={};Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.version=void 0,Nt.version="0.0.0-automated",Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.DEFAULT_HEADERS=void 0;const ic=Nt;Dt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${ic.version}`};var Rs=le&&le.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(_r,"__esModule",{value:!0});const ac=Rs(Rt),lc=Rs(st),cc=Dt;let uc=class _o{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},cc.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new ac.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new _o(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:o}={}){let i;const a=new URL(`${this.url}/rpc/${e}`);let l;r||s?(i=r?"HEAD":"GET",Object.entries(t).filter(([u,h])=>h!==void 0).map(([u,h])=>[u,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([u,h])=>{a.searchParams.append(u,h)})):(i="POST",l=t);const c=Object.assign({},this.headers);return o&&(c.Prefer=`count=${o}`),new lc.default({method:i,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};_r.default=uc;var Ge=le&&le.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(re,"__esModule",{value:!0}),re.PostgrestError=re.PostgrestBuilder=re.PostgrestTransformBuilder=re.PostgrestFilterBuilder=re.PostgrestQueryBuilder=re.PostgrestClient=void 0;const Os=Ge(_r);re.PostgrestClient=Os.default;const Is=Ge(Rt);re.PostgrestQueryBuilder=Is.default;const Ls=Ge(st);re.PostgrestFilterBuilder=Ls.default;const Ds=Ge(Ot);re.PostgrestTransformBuilder=Ds.default;const Ns=Ge(It);re.PostgrestBuilder=Ns.default;const Ms=Ge(Lt);re.PostgrestError=Ms.default;var dc=re.default={PostgrestClient:Os.default,PostgrestQueryBuilder:Is.default,PostgrestFilterBuilder:Ls.default,PostgrestTransformBuilder:Ds.default,PostgrestBuilder:Ns.default,PostgrestError:Ms.default};const{PostgrestClient:hc,PostgrestQueryBuilder:md,PostgrestFilterBuilder:vd,PostgrestTransformBuilder:bd,PostgrestBuilder:yd,PostgrestError:wd}=dc,fc={"X-Client-Info":"realtime-js/2.11.2"},pc="1.0.0",Us=1e4,gc=1e3;var Je;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Je||(Je={}));var ae;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(ae||(ae={}));var he;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(he||(he={}));var kr;(function(n){n.websocket="websocket"})(kr||(kr={}));var Oe;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Oe||(Oe={}));class mc{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),o=t.getUint8(2);let i=this.HEADER_LENGTH+2;const a=r.decode(e.slice(i,i+s));i=i+s;const l=r.decode(e.slice(i,i+o));i=i+o;const c=JSON.parse(r.decode(e.slice(i,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class zs{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var W;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(W||(W={}));const Fs=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((o,i)=>(o[i]=vc(i,n,e,s),o),{})},vc=(n,e,t,r)=>{const s=e.find(a=>a.name===n),o=s==null?void 0:s.type,i=t[n];return o&&!r.includes(o)?Bs(o,i):xr(i)},Bs=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return _c(e,t)}switch(n){case W.bool:return bc(e);case W.float4:case W.float8:case W.int2:case W.int4:case W.int8:case W.numeric:case W.oid:return yc(e);case W.json:case W.jsonb:return wc(e);case W.timestamp:return kc(e);case W.abstime:case W.date:case W.daterange:case W.int4range:case W.int8range:case W.money:case W.reltime:case W.text:case W.time:case W.timestamptz:case W.timetz:case W.tsrange:case W.tstzrange:return xr(e);default:return xr(e)}},xr=n=>n,bc=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},yc=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},wc=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},_c=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let o;const i=n.slice(1,t);try{o=JSON.parse("["+i+"]")}catch{o=i?i.split(","):[]}return o.map(a=>Bs(e,a))}return n},kc=n=>typeof n=="string"?n.replace(" ","T"):n,qs=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Sr{constructor(e,t,r={},s=Us){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ws;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Ws||(Ws={}));class it{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:o,onLeave:i,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=it.syncState(this.state,s,o,i),this.pendingDiffs.forEach(l=>{this.state=it.syncDiff(this.state,l,o,i)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:o,onLeave:i,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=it.syncDiff(this.state,s,o,i),a())}),this.onJoin((s,o,i)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:o,newPresences:i})}),this.onLeave((s,o,i)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:o,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const o=this.cloneDeep(e),i=this.transformState(t),a={},l={};return this.map(o,(c,u)=>{i[c]||(l[c]=u)}),this.map(i,(c,u)=>{const h=o[c];if(h){const d=u.map(y=>y.presence_ref),f=h.map(y=>y.presence_ref),v=u.filter(y=>f.indexOf(y.presence_ref)<0),g=h.filter(y=>d.indexOf(y.presence_ref)<0);v.length>0&&(a[c]=v),g.length>0&&(l[c]=g)}else a[c]=u}),this.syncDiff(o,{joins:a,leaves:l},r,s)}static syncDiff(e,t,r,s){const{joins:o,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(o,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const h=e[a].map(f=>f.presence_ref),d=u.filter(f=>h.indexOf(f.presence_ref)<0);e[a].unshift(...d)}r(a,u,l)}),this.map(i,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(h=>h.presence_ref);c=c.filter(h=>u.indexOf(h.presence_ref)<0),e[a]=c,s(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Hs;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Hs||(Hs={}));var Vs;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Vs||(Vs={}));var ye;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(ye||(ye={}));class Er{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=ae.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Sr(this,he.join,this.params,this.timeout),this.rejoinTimer=new zs(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ae.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ae.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=ae.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ae.errored,this.rejoinTimer.scheduleTimeout())}),this._on(he.reply,{},(s,o)=>{this._trigger(this._replyEventName(o),s)}),this.presence=new it(this),this.broadcastEndpointURL=qs(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:o,presence:i,private:a}}=this.params;this._onError(u=>e==null?void 0:e(ye.CHANNEL_ERROR,u)),this._onClose(()=>e==null?void 0:e(ye.CLOSED));const l={},c={broadcast:o,presence:i,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&s!==void 0?s:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:u})=>{var h;if(this.socket.setAuth(),u===void 0){e==null||e(ye.SUBSCRIBED);return}else{const d=this.bindings.postgres_changes,f=(h=d==null?void 0:d.length)!==null&&h!==void 0?h:0,v=[];for(let g=0;g<f;g++){const y=d[g],{filter:{event:S,schema:b,table:_,filter:k}}=y,E=u&&u[g];if(E&&E.event===S&&E.schema===b&&E.table===_&&E.filter===k)v.push(Object.assign(Object.assign({},y),{id:E.id}));else{this.unsubscribe(),e==null||e(ye.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e(ye.SUBSCRIBED);return}}).receive("error",u=>{e==null||e(ye.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(ye.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:i}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:i,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=c.body)===null||s===void 0?void 0:s.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var i,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(i=this.params)===null||i===void 0?void 0:i.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&o("ok"),c.receive("ok",()=>o("ok")),c.receive("error",()=>o("error")),c.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=ae.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(he.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new Sr(this,he.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}async _fetchWithTimeout(e,t,r){const s=new AbortController,o=setTimeout(()=>s.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(o),i}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Sr(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,o;const i=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=he;if(r&&[a,l,c,u].indexOf(i)>=0&&r!==this._joinRef())return;let d=this._onMessage(i,t,r);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var v,g,y;return((v=f.filter)===null||v===void 0?void 0:v.event)==="*"||((y=(g=f.filter)===null||g===void 0?void 0:g.event)===null||y===void 0?void 0:y.toLocaleLowerCase())===i}).map(f=>f.callback(d,r)):(o=this.bindings[i])===null||o===void 0||o.filter(f=>{var v,g,y,S,b,_;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in f){const k=f.id,E=(v=f.filter)===null||v===void 0?void 0:v.event;return k&&((g=t.ids)===null||g===void 0?void 0:g.includes(k))&&(E==="*"||(E==null?void 0:E.toLocaleLowerCase())===((y=t.data)===null||y===void 0?void 0:y.type.toLocaleLowerCase()))}else{const k=(b=(S=f==null?void 0:f.filter)===null||S===void 0?void 0:S.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return k==="*"||k===((_=t==null?void 0:t.event)===null||_===void 0?void 0:_.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===i}).map(f=>{if(typeof d=="object"&&"ids"in d){const v=d.data,{schema:g,table:y,commit_timestamp:S,type:b,errors:_}=v;d=Object.assign(Object.assign({},{schema:g,table:y,commit_timestamp:S,eventType:b,new:{},old:{},errors:_}),this._getPayloadRecords(v))}f.callback(d,r)})}_isClosed(){return this.state===ae.closed}_isJoined(){return this.state===ae.joined}_isJoining(){return this.state===ae.joining}_isLeaving(){return this.state===ae.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),o={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(o):this.bindings[s]=[o],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var o;return!(((o=s.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===r&&Er.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(he.close,{},e)}_onError(e){this._on(he.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ae.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Fs(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Fs(e.columns,e.old_record)),t}}const xc=()=>{},Sc=typeof WebSocket<"u",Ec=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Cc{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=fc,this.params={},this.timeout=Us,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=xc,this.conn=null,this.sendBuffer=[],this.serializer=new mc,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=o=>{let i;return o?i=o:typeof fetch>"u"?i=(...a)=>Promise.resolve().then(()=>Ve).then(({default:l})=>l(...a)):i=fetch,(...a)=>i(...a)},this.endPoint=`${e}/${kr.websocket}`,this.httpEndpoint=qs(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:o=>[1e3,2e3,5e3,1e4][o-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(o,i)=>i(JSON.stringify(o)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new zs(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(Sc){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new Tc(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),Promise.resolve().then(()=>ld).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:pc}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Je.connecting:return Oe.Connecting;case Je.open:return Oe.Open;case Je.closing:return Oe.Closing;default:return Oe.Closed}}isConnected(){return this.connectionState()===Oe.Open}channel(e,t={config:{}}){const r=new Er(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:o}=e,i=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${r} (${o})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let r=null;try{r=JSON.parse(atob(t.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=t,this.channels.forEach(s=>{t&&s.updateJoinPayload({access_token:t}),s.joinedOnce&&s._isJoined()&&s._push(he.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(gc,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:o,ref:i}=t;i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${o.status||""} ${r} ${s} ${i&&"("+i+")"||""}`,o),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,o,i)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(he.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([Ec],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class Tc{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Je.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class Cr extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Y(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Ac extends Cr{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Tr extends Cr{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Pc=function(n,e,t,r){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(u){try{c(r.next(u))}catch(h){i(h)}}function l(u){try{c(r.throw(u))}catch(h){i(h)}}function c(u){u.done?o(u.value):s(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};const Gs=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(()=>Ve).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},$c=()=>Pc(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Promise.resolve().then(()=>Ve)).Response:Response}),Ar=n=>{if(Array.isArray(n))return n.map(t=>Ar(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[s]=Ar(r)}),e};var Ie=function(n,e,t,r){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(u){try{c(r.next(u))}catch(h){i(h)}}function l(u){try{c(r.throw(u))}catch(h){i(h)}}function c(u){u.done?o(u.value):s(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};const Pr=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),jc=(n,e,t)=>Ie(void 0,void 0,void 0,function*(){const r=yield $c();n instanceof r&&!(t!=null&&t.noResolveJson)?n.json().then(s=>{e(new Ac(Pr(s),n.status||500))}).catch(s=>{e(new Tr(Pr(s),s))}):e(new Tr(Pr(n),n))}),Rc=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(s.body=JSON.stringify(r)),Object.assign(Object.assign({},s),t))};function at(n,e,t,r,s,o){return Ie(this,void 0,void 0,function*(){return new Promise((i,a)=>{n(t,Rc(e,r,s,o)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>jc(l,a,r))})})}function Mt(n,e,t,r){return Ie(this,void 0,void 0,function*(){return at(n,"GET",e,t,r)})}function Ee(n,e,t,r,s){return Ie(this,void 0,void 0,function*(){return at(n,"POST",e,r,s,t)})}function Oc(n,e,t,r,s){return Ie(this,void 0,void 0,function*(){return at(n,"PUT",e,r,s,t)})}function Ic(n,e,t,r){return Ie(this,void 0,void 0,function*(){return at(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function Js(n,e,t,r,s){return Ie(this,void 0,void 0,function*(){return at(n,"DELETE",e,r,s,t)})}var ne=function(n,e,t,r){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(u){try{c(r.next(u))}catch(h){i(h)}}function l(u){try{c(r.throw(u))}catch(h){i(h)}}function c(u){u.done?o(u.value):s(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};const Lc={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ks={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Dc{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Gs(s)}uploadOrUpdate(e,t,r,s){return ne(this,void 0,void 0,function*(){try{let o;const i=Object.assign(Object.assign({},Ks),s);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(i.upsert)});const l=i.metadata;typeof Blob<"u"&&r instanceof Blob?(o=new FormData,o.append("cacheControl",i.cacheControl),l&&o.append("metadata",this.encodeMetadata(l)),o.append("",r)):typeof FormData<"u"&&r instanceof FormData?(o=r,o.append("cacheControl",i.cacheControl),l&&o.append("metadata",this.encodeMetadata(l))):(o=r,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),s!=null&&s.headers&&(a=Object.assign(Object.assign({},a),s.headers));const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),h=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:o,headers:a},i!=null&&i.duplex?{duplex:i.duplex}:{})),d=yield h.json();return h.ok?{data:{path:c,id:d.Id,fullPath:d.Key},error:null}:{data:null,error:d}}catch(o){if(Y(o))return{data:null,error:o};throw o}})}upload(e,t,r){return ne(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return ne(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),i=this._getFinalPath(o),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:Ks.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const h=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),d=yield h.json();return h.ok?{data:{path:o,fullPath:d.Key},error:null}:{data:null,error:d}}catch(l){if(Y(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return ne(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const o=yield Ee(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),i=new URL(this.url+o.url),a=i.searchParams.get("token");if(!a)throw new Cr("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(r){if(Y(r))return{data:null,error:r};throw r}})}update(e,t,r){return ne(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return ne(this,void 0,void 0,function*(){try{return{data:yield Ee(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(Y(s))return{data:null,error:s};throw s}})}copy(e,t,r){return ne(this,void 0,void 0,function*(){try{return{data:{path:(yield Ee(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(Y(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return ne(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),o=yield Ee(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${i}`)},{data:o,error:null}}catch(s){if(Y(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return ne(this,void 0,void 0,function*(){try{const s=yield Ee(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${o}`):null})),error:null}}catch(s){if(Y(s))return{data:null,error:s};throw s}})}download(e,t){return ne(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),i=o?`?${o}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Mt(this.fetch,`${this.url}/${s}/${a}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(Y(a))return{data:null,error:a};throw a}})}info(e){return ne(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Mt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Ar(r),error:null}}catch(r){if(Y(r))return{data:null,error:r};throw r}})}exists(e){return ne(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Ic(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Y(r)&&r instanceof Tr){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],o=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&s.push(o);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&s.push(l);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return ne(this,void 0,void 0,function*(){try{return{data:yield Js(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Y(t))return{data:null,error:t};throw t}})}list(e,t,r){return ne(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Lc),t),{prefix:e||""});return{data:yield Ee(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(Y(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Nc={"X-Client-Info":"storage-js/2.7.1"};var Ke=function(n,e,t,r){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(u){try{c(r.next(u))}catch(h){i(h)}}function l(u){try{c(r.throw(u))}catch(h){i(h)}}function c(u){u.done?o(u.value):s(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};class Mc{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},Nc),t),this.fetch=Gs(r)}listBuckets(){return Ke(this,void 0,void 0,function*(){try{return{data:yield Mt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Y(e))return{data:null,error:e};throw e}})}getBucket(e){return Ke(this,void 0,void 0,function*(){try{return{data:yield Mt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Y(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Ke(this,void 0,void 0,function*(){try{return{data:yield Ee(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Y(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Ke(this,void 0,void 0,function*(){try{return{data:yield Oc(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Y(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Ke(this,void 0,void 0,function*(){try{return{data:yield Ee(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Y(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Ke(this,void 0,void 0,function*(){try{return{data:yield Js(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Y(t))return{data:null,error:t};throw t}})}}class Uc extends Mc{constructor(e,t={},r){super(e,t,r)}from(e){return new Dc(this.url,this.headers,e,this.fetch)}}const zc="2.49.4";let lt="";typeof Deno<"u"?lt="deno":typeof document<"u"?lt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?lt="react-native":lt="node";const Fc={headers:{"X-Client-Info":`supabase-js-${lt}/${zc}`}},Bc={schema:"public"},qc={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Wc={};var Hc=function(n,e,t,r){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(u){try{c(r.next(u))}catch(h){i(h)}}function l(u){try{c(r.throw(u))}catch(h){i(h)}}function c(u){u.done?o(u.value):s(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};const Vc=n=>{let e;return n?e=n:typeof fetch>"u"?e=Ps:e=fetch,(...t)=>e(...t)},Gc=()=>typeof Headers>"u"?$s:Headers,Jc=(n,e,t)=>{const r=Vc(t),s=Gc();return(o,i)=>Hc(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:n;let c=new s(i==null?void 0:i.headers);return c.has("apikey")||c.set("apikey",n),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(o,Object.assign(Object.assign({},i),{headers:c}))})};var Kc=function(n,e,t,r){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(u){try{c(r.next(u))}catch(h){i(h)}}function l(u){try{c(r.throw(u))}catch(h){i(h)}}function c(u){u.done?o(u.value):s(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};function Yc(n){return n.replace(/\/$/,"")}function Xc(n,e){const{db:t,auth:r,realtime:s,global:o}=n,{db:i,auth:a,realtime:l,global:c}=e,u={db:Object.assign(Object.assign({},i),t),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),s),global:Object.assign(Object.assign({},c),o),accessToken:()=>Kc(this,void 0,void 0,function*(){return""})};return n.accessToken?u.accessToken=n.accessToken:delete u.accessToken,u}const Ys="2.69.1",Ye=30*1e3,$r=3,jr=$r*Ye,Zc="http://localhost:9999",Qc="supabase.auth.token",eu={"X-Client-Info":`gotrue-js/${Ys}`},Rr="X-Supabase-Api-Version",Xs={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},tu=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,ru=6e5;class Or extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function D(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class nu extends Or{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function su(n){return D(n)&&n.name==="AuthApiError"}class Zs extends Or{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ce extends Or{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class Te extends Ce{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function ou(n){return D(n)&&n.name==="AuthSessionMissingError"}class Ir extends Ce{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ut extends Ce{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class zt extends Ce{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function iu(n){return D(n)&&n.name==="AuthImplicitGrantRedirectError"}class Qs extends Ce{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Lr extends Ce{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Dr(n){return D(n)&&n.name==="AuthRetryableFetchError"}class eo extends Ce{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class ct extends Ce{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const to="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ro=` 	
\r=`.split(""),au=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<ro.length;e+=1)n[ro[e].charCodeAt(0)]=-2;for(let e=0;e<to.length;e+=1)n[to[e].charCodeAt(0)]=e;return n})();function no(n,e,t){const r=au[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function so(n){const e=[],t=i=>{e.push(String.fromCodePoint(i))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},o=i=>{uu(i,r,t)};for(let i=0;i<n.length;i+=1)no(n.charCodeAt(i),s,o);return e.join("")}function lu(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function cu(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}lu(r,e)}}function uu(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if(!(n>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function du(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<n.length;s+=1)no(n.charCodeAt(s),t,r);return new Uint8Array(e)}function hu(n){const e=[];return cu(n,t=>e.push(t)),new Uint8Array(e)}function fu(n){return Math.round(Date.now()/1e3)+n}function pu(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const ve=()=>typeof window<"u"&&typeof document<"u",Le={tested:!1,writable:!1},ut=()=>{if(!ve())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Le.tested)return Le.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Le.tested=!0,Le.writable=!0}catch{Le.tested=!0,Le.writable=!1}return Le.writable};function gu(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,o)=>{e[o]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const oo=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(()=>Ve).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},mu=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",io=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Ft=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Bt=async(n,e)=>{await n.removeItem(e)};class qt{constructor(){this.promise=new qt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}qt.promiseConstructor=Promise;function Nr(n){const e=n.split(".");if(e.length!==3)throw new ct("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!tu.test(e[r]))throw new ct("JWT not in base64url format");return{header:JSON.parse(so(e[0])),payload:JSON.parse(so(e[1])),signature:du(e[2]),raw:{header:e[0],payload:e[1]}}}async function vu(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function bu(n,e){return new Promise((r,s)=>{(async()=>{for(let o=0;o<1/0;o++)try{const i=await n(o);if(!e(o,null,i)){r(i);return}}catch(i){if(!e(o,i)){s(i);return}}})()})}function yu(n){return("0"+n.toString(16)).substr(-2)}function wu(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let o=0;o<56;o++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,yu).join("")}async function _u(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(o=>String.fromCharCode(o)).join("")}async function ku(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await _u(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Xe(n,e,t=!1){const r=wu();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await io(n,`${e}-code-verifier`,s);const o=await ku(r);return[o,r===o?"plain":"s256"]}const xu=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Su(n){const e=n.headers.get(Rr);if(!e||!e.match(xu))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Eu(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function Cu(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var Tu=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const De=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Au=[502,503,504];async function ao(n){var e;if(!mu(n))throw new Lr(De(n),0);if(Au.includes(n.status))throw new Lr(De(n),n.status);let t;try{t=await n.json()}catch(o){throw new Zs(De(o),o)}let r;const s=Su(n);if(s&&s.getTime()>=Xs["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new eo(De(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Te}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((o,i)=>o&&typeof i=="string",!0))throw new eo(De(t),n.status,t.weak_password.reasons);throw new nu(De(t),n.status||500,r)}const Pu=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function N(n,e,t,r){var s;const o=Object.assign({},r==null?void 0:r.headers);o[Rr]||(o[Rr]=Xs["2024-01-01"].name),r!=null&&r.jwt&&(o.Authorization=`Bearer ${r.jwt}`);const i=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(i.redirect_to=r.redirectTo);const a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await $u(n,e,t+a,{headers:o,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function $u(n,e,t,r,s,o){const i=Pu(e,r,s,o);let a;try{a=await n(t,Object.assign({},i))}catch(l){throw console.error(l),new Lr(De(l),0)}if(a.ok||await ao(a),r!=null&&r.noResolveJson)return a;try{return await a.json()}catch(l){await ao(l)}}function Ae(n){var e;let t=null;Iu(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=fu(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function lo(n){const e=Ae(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Pe(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function ju(n){return{data:n,error:null}}function Ru(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:o}=n,i=Tu(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:o},l=Object.assign({},i);return{data:{properties:a,user:l},error:null}}function Ou(n){return n}function Iu(n){return n.access_token&&n.refresh_token&&n.expires_in}var Lu=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class Du{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=oo(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await N(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(D(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await N(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Pe})}catch(r){if(D(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Lu(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await N(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Ru,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(D(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await N(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Pe})}catch(t){if(D(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,o,i,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await N(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(o=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:Ou});if(u.error)throw u.error;const h=await u.json(),d=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(v=>{const g=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(v.split(";")[1].split("=")[1]);c[`${y}Page`]=g}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(D(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){try{return await N(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Pe})}catch(t){if(D(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await N(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Pe})}catch(r){if(D(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await N(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Pe})}catch(r){if(D(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await N(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(D(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await N(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}}}const Nu={getItem:n=>ut()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{ut()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{ut()&&globalThis.localStorage.removeItem(n)}};function co(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function Mu(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Ze={debug:!!(globalThis&&ut()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class uo extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Uu extends uo{}async function zu(n,e,t){Ze.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Ze.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){Ze.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{Ze.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw Ze.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Uu(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Ze.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Mu();const Fu={url:Zc,storageKey:Qc,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:eu,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function ho(n,e,t){return await t()}class dt{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=dt.nextInstanceID,dt.nextInstanceID+=1,this.instanceID>0&&ve()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Fu),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Du({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=oo(s.fetch),this.lock=s.lock||ho,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:ve()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=zu:this.lock=ho,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:ut()?this.storage=Nu:(this.memoryStorage={},this.storage=co(this.memoryStorage)):(this.memoryStorage={},this.storage=co(this.memoryStorage)),ve()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Ys}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=gu(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),ve()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:o}=await this._getSessionFromURL(t,r);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),iu(o)){const l=(e=o.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:i,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return D(t)?{error:t}:{error:new Zs("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const o=await N(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:Ae}),{data:i,error:a}=o;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(D(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(e){var t,r,s;try{let o;if("email"in e){const{email:u,password:h,options:d}=e;let f=null,v=null;this.flowType==="pkce"&&([f,v]=await Xe(this.storage,this.storageKey)),o=await N(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:u,password:h,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:f,code_challenge_method:v},xform:Ae})}else if("phone"in e){const{phone:u,password:h,options:d}=e;o=await N(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=d==null?void 0:d.data)!==null&&r!==void 0?r:{},channel:(s=d==null?void 0:d.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:Ae})}else throw new Ut("You must provide either an email or phone number and a password");const{data:i,error:a}=o;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(D(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(e){try{let t;if("email"in e){const{email:o,password:i,options:a}=e;t=await N(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:lo})}else if("phone"in e){const{phone:o,password:i,options:a}=e;t=await N(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:lo})}else throw new Ut("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Ir}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Ft(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:o,error:i}=await N(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Ae});if(await Bt(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new Ir}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:s??null}),error:i})}catch(o){if(D(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:o,nonce:i}=e,a=await N(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:o,nonce:i,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Ae}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Ir}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,o,i;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await Xe(this.storage,this.storageKey));const{error:h}=await N(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await N(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(o=l==null?void 0:l.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(i=l==null?void 0:l.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new Ut("You must provide either an email or phone number.")}catch(a){if(D(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,r;try{let s,o;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,o=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:i,error:a}=await N(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:s,xform:Ae});if(a)throw a;if(!i)throw new Error("An error occurred on token verification.");const l=i.session,c=i.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(D(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let o=null,i=null;return this.flowType==="pkce"&&([o,i]=await Xe(this.storage,this.storageKey)),await N(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:i}),headers:this.headers,xform:ju})}catch(o){if(D(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Te;const{error:s}=await N(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(D(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:o}=e,{error:i}=await N(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in e){const{phone:r,type:s,options:o}=e,{data:i,error:a}=await N(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return{data:{user:null,session:null,messageId:i==null?void 0:i.message_id},error:a}}throw new Ut("You must provide either an email or phone number and a type")}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ft(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<jr:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let i=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!i&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:s,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await N(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Pe}):await this._useSession(async t=>{var r,s,o;const{data:i,error:a}=t;if(a)throw a;return!(!((r=i.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Te}:await N(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&o!==void 0?o:void 0,xform:Pe})})}catch(t){if(D(t))return ou(t)&&(await this._removeSession(),await Bt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:o}=r;if(o)throw o;if(!s.session)throw new Te;const i=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Xe(this.storage,this.storageKey));const{data:c,error:u}=await N(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:i.access_token,xform:Pe});if(u)throw u;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(r){if(D(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Te;const t=Date.now()/1e3;let r=t,s=!0,o=null;const{payload:i}=Nr(e.access_token);if(i.exp&&(r=i.exp,s=r<=t),s){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};o=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;o={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(t){if(D(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:i,error:a}=t;if(a)throw a;e=(r=i.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Te;const{session:s,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!ve())throw new zt("No browser detected.");if(e.error||e.error_description||e.error_code)throw new zt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Qs("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new zt("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Qs("No code detected.");const{data:b,error:_}=await this._exchangeCodeForSession(e.code);if(_)throw _;const k=new URL(window.location.href);return k.searchParams.delete("code"),window.history.replaceState(window.history.state,"",k.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:o,refresh_token:i,expires_in:a,expires_at:l,token_type:c}=e;if(!o||!a||!i||!c)throw new zt("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(a);let d=u+h;l&&(d=parseInt(l));const f=d-u;f*1e3<=Ye&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const v=d-h;u-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,d,u):u-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,d,u);const{data:g,error:y}=await this._getUser(o);if(y)throw y;const S={provider_token:r,provider_refresh_token:s,access_token:o,expires_in:h,expires_at:d,refresh_token:i,token_type:c,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:S,redirectType:e.type},error:null}}catch(r){if(D(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ft(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:o}=t;if(o)return{error:o};const i=(r=s.session)===null||r===void 0?void 0:r.access_token;if(i){const{error:a}=await this.admin.signOut(i,e);if(a&&!(su(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Bt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=pu(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:o},error:i}=t;if(i)throw i;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await Xe(this.storage,this.storageKey,!0));try{return await N(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(D(o))return{data:null,error:o};throw o}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async o=>{var i,a,l,c,u;const{data:h,error:d}=o;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await N(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return ve()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(D(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:o,error:i}=t;if(i)throw i;return await N(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(D(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await bu(async s=>(s>0&&await vu(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await N(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ae})),(s,o)=>{const i=200*Math.pow(2,s);return o&&Dr(o)&&Date.now()+i-r<Ye})}catch(r){if(this._debug(t,"error",r),D(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),ve()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Ft(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const s=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<jr;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${jr}s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=await this._callRefreshToken(r.refresh_token);o&&(console.error(o),Dr(o)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Te;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new qt;const{data:o,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!o.session)throw new Te;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const a={session:o.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(o){if(this._debug(s,"error",o),D(o)){const i={session:null,error:o};return Dr(o)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(i),i}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(o),o}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const o=[],i=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){o.push(l)}});if(await Promise.all(i),o.length>0){for(let a=0;a<o.length;a+=1)console.error(o[a]);throw o[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await io(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Bt(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ve()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ye);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/Ye);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Ye}ms, refresh threshold is ${$r} ticks`),s<=$r&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof uo)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ve()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[o,i]=await Xe(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(i)}`});s.push(a.toString())}if(r!=null&&r.queryParams){const o=new URLSearchParams(r.queryParams);s.push(o.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:o}=t;return o?{data:null,error:o}:await N(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(D(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:o,error:i}=t;if(i)return{data:null,error:i};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await N(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=o==null?void 0:o.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(D(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:o}=t;if(o)return{data:null,error:o};const{data:i,error:a}=await N(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:a})})}catch(t){if(D(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:o}=t;return o?{data:null,error:o}:await N(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(D(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(i=>i.factor_type==="totp"&&i.status==="verified"),o=r.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:r,totp:s,phone:o},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:o}=e;if(o)return{data:null,error:o};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Nr(s.access_token);let a=null;i.aal&&(a=i.aal);let l=a;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const u=i.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(i=>i.kid===e);if(r||(r=this.jwks.keys.find(i=>i.kid===e),r&&this.jwks_cached_at+ru>Date.now()))return r;const{data:s,error:o}=await N(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;if(!s.keys||s.keys.length===0)throw new ct("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),r=s.keys.find(i=>i.kid===e),!r)throw new ct("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:f,error:v}=await this.getSession();if(v||!f.session)return{data:null,error:v};r=f.session.access_token}const{header:s,payload:o,signature:i,raw:{header:a,payload:l}}=Nr(r);if(Eu(o.exp),!s.kid||s.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:f}=await this.getUser(r);if(f)throw f;return{data:{claims:o,header:s,signature:i},error:null}}const c=Cu(s.alg),u=await this.fetchJwk(s.kid,t),h=await crypto.subtle.importKey("jwk",u,c,!0,["verify"]);if(!await crypto.subtle.verify(c,h,i,hu(`${a}.${l}`)))throw new ct("Invalid JWT signature");return{data:{claims:o,header:s,signature:i},error:null}}catch(r){if(D(r))return{data:null,error:r};throw r}}}dt.nextInstanceID=0;const Bu=dt;class qu extends Bu{constructor(e){super(e)}}var Wu=function(n,e,t,r){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(u){try{c(r.next(u))}catch(h){i(h)}}function l(u){try{c(r.throw(u))}catch(h){i(h)}}function c(u){u.done?o(u.value):s(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};class Hu{constructor(e,t,r){var s,o,i;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=Yc(e);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;const l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,c={db:Bc,realtime:Wc,auth:Object.assign(Object.assign({},qc),{storageKey:l}),global:Fc},u=Xc(r??{},c);this.storageKey=(s=u.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(o=u.global.headers)!==null&&o!==void 0?o:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=u.auth)!==null&&i!==void 0?i:{},this.headers,u.global.fetch),this.fetch=Jc(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new hc(`${a}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new Bl(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Uc(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Wu(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:o,flowType:i,lock:a,debug:l},c,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new qu({url:this.authUrl,headers:Object.assign(Object.assign({},h),c),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:i,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Cc(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const X=((n,e,t)=>new Hu(n,e,t))("https://fwchkusgryebslnjkoly.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3Y2hrdXNncnllYnNsbmprb2x5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5MjkyMTcsImV4cCI6MjA2MDUwNTIxN30.ZP4Qh8Lb6DWmTlawIDHNuAnkUanInBmKblCCRVa0QuY"),Vu=async n=>{var e;try{console.log("Отправка сообщения:",n);const{data:t,error:r}=await X.from("conversations").insert([{user_query:n,bot_response:""}]).select().single();if(r)return console.error("Ошибка при отправке сообщения:",r),J.error("Ошибка при отправке сообщения"),null;let s;try{s=await Promise.race([X.functions.invoke("yandex-gpt-proxy",{body:{message:n,conversationId:t.id}}),new Promise((a,l)=>setTimeout(()=>l(new Error("Превышено время ожидания от сервера")),15e3))])}catch(a){return console.error("Ошибка вызова функции:",a),J.error("Сервер не ответил вовремя, но ваше сообщение сохранено"),await X.from("conversations").update({bot_response:"Ответ не получен. Пожалуйста, повторите запрос позже."}).eq("id",t.id),{...t,bot_response:"Ответ не получен. Пожалуйста, повторите запрос позже."}}if(s.error)return console.error("Ошибка вызова функции:",s.error),J.error("Произошла ошибка при обработке запроса"),await X.from("conversations").update({bot_response:"Функция обработки сообщений временно недоступна."}).eq("id",t.id),{...t,bot_response:"Функция обработки сообщений временно недоступна."};const{data:o,error:i}=await X.from("conversations").select().eq("id",t.id).single();return i?(console.error("Ошибка при получении ответа:",i),J.error("Не удалось получить ответ"),t):(e=s==null?void 0:s.data)!=null&&e.bot_response?(console.log("Используем прямой ответ из функции:",s.data.bot_response),{...o,bot_response:s.data.bot_response}):o.bot_response?(console.log("Получен ответ:",o),o):(console.log("Пустой ответ от сервера"),await X.from("conversations").update({bot_response:"Бот не смог сформулировать ответ. Пожалуйста, попробуйте задать вопрос по-другому."}).eq("id",t.id),{...o,bot_response:"Бот не смог сформулировать ответ. Пожалуйста, попробуйте задать вопрос по-другому."})}catch(t){return console.error("Произошла ошибка:",t),J.error("Произошла ошибка при отправке сообщения"),null}},Gu=async(n=25)=>{try{const{data:e,error:t}=await X.from("conversations").select("*").order("timestamp",{ascending:!1}).limit(n);return t?(console.error("Ошибка при получении истории сообщений:",t),J.error("Не удалось загрузить историю сообщений"),[]):e.reverse()}catch(e){return console.error("Произошла ошибка при загрузке истории:",e),J.error("Произошла ошибка при загрузке истории"),[]}},Ju=()=>{const[n,e]=C.useState([]),[t,r]=C.useState(!1),[s,o]=C.useState("");C.useRef(null);const i=async()=>{const b=await Gu(25);e(b)},a=()=>{s.trim()&&(l(s),o(""))},l=async b=>{if(!b.trim()||t)return;if(r(!0),c(b)){await u(b),r(!1);return}const _={user_query:b,bot_response:"",isLoading:!0};e(k=>[...k,_]);try{const k=await Vu(b);k?(e(E=>E.filter(A=>!A.isLoading).concat([k])),await d(k.bot_response,b)):e(E=>E.map(A=>A.isLoading?{...A,isLoading:!1,bot_response:"Не удалось получить ответ"}:A))}catch(k){console.error("Ошибка при обработке сообщения:",k),e(E=>E.map(A=>A.isLoading?{...A,isLoading:!1,bot_response:"Произошла ошибка"}:A))}finally{r(!1)}},c=b=>["подтверждаю","да","точно","согласен","подтвердить","отменить","отмени","удали","удалить","убери"].some(k=>b.toLowerCase().includes(k)),u=async b=>{const k=n.slice(-3).find(E=>E.bot_response&&(E.bot_response.toLowerCase().includes("вы действительно хотите отменить бронирование")||E.bot_response.toLowerCase().includes("подтвердите отмену бронирования")));if(k){const A=k.bot_response.match(/бронирование\s+(\w+\s+\w+|\w+)/i),$=A?A[1]:null;if($&&h(b)){const O={user_query:b,bot_response:"",isLoading:!0};e(P=>[...P,O]);try{const{data:P,error:U}=await X.from("bookings").select("*").ilike("guest_name",`%${$}%`).eq("status","confirmed").limit(1).single();if(U)throw new Error(`Ошибка при получении данных бронирования: ${U.message}`);P?(await S("delete",{id:P.id,guest_name:P.guest_name}),e(G=>G.map(I=>I.isLoading?{...I,isLoading:!1,bot_response:`✅ Бронирование для ${P.guest_name} успешно отменено!`}:I))):e(G=>G.map(I=>I.isLoading?{...I,isLoading:!1,bot_response:`❌ Не удалось найти активное бронирование для ${$}`}:I))}catch(P){console.error("Ошибка при отмене бронирования:",P),e(U=>U.map(G=>G.isLoading?{...G,isLoading:!1,bot_response:`❌ Не удалось отменить бронирование: ${P.message}`}:G))}return!0}}return!1},h=b=>["подтверждаю","да","точно","согласен","подтвердить"].some(k=>b.toLowerCase().includes(k)),d=async(b,_)=>{const k=_.toLowerCase().includes("отмени бронь")||_.toLowerCase().includes("отменить бронь")||_.toLowerCase().includes("удали бронирование");(_.toLowerCase().includes("покажи сообщения")||_.toLowerCase().includes("покажи сообщение от")||_.toLowerCase().includes("покажи непрочитанные")||_.toLowerCase().includes("покажи переписку"))&&b.includes("сообщение")&&b.includes("найдено")&&console.log("Запрос на просмотр сообщений WhatsApp обработан в GPT"),k&&b.includes("действительно")&&console.log("Обнаружен запрос на подтверждение отмены бронирования")},f=async b=>{try{r(!0);let _=X.from("whatsapp_messages").select("*");b.guestName&&(_=_.ilike("guest_name",`%${b.guestName}%`)),b.phoneNumber&&(_=_.eq("phone_number",b.phoneNumber)),b.onlyUnread&&(_=_.eq("is_read",!1)),_=_.order("created_at",{ascending:!1}),_=_.limit(b.limit||20);const{data:k,error:E}=await _;if(E)throw new Error(`Ошибка при получении сообщений WhatsApp: ${E.message}`);if(k&&k.length>0){const A=v(k,b),$={user_query:`Показать сообщения${b.guestName?` от ${b.guestName}`:""}${b.onlyUnread?" (непрочитанные)":""}`,bot_response:A,isLoading:!1};if(e(O=>[...O,$]),b.onlyUnread){const O=k.map(P=>P.id);await X.from("whatsapp_messages").update({is_read:!0}).in("id",O)}return k}else{const A={user_query:`Показать сообщения${b.guestName?` от ${b.guestName}`:""}${b.onlyUnread?" (непрочитанные)":""}`,bot_response:`📱 Сообщений${b.guestName?` от ${b.guestName}`:""}${b.onlyUnread?" (непрочитанных)":""} не найдено.`,isLoading:!1};return e($=>[...$,A]),[]}}catch(_){console.error("Ошибка при получении сообщений WhatsApp:",_);const k={user_query:`Показать сообщения${b.guestName?` от ${b.guestName}`:""}`,bot_response:`❌ Не удалось получить сообщения: ${_.message}`,isLoading:!1};return e(E=>[...E,k]),[]}finally{r(!1)}},v=(b,_)=>{if(!b||b.length===0)return"Сообщений не найдено";let k="";_.guestName?k+=`📱 **Сообщения ${_.onlyUnread?"непрочитанные ":""}от ${_.guestName}**

`:_.onlyUnread?k+=`📱 **Непрочитанные сообщения**

`:k+=`📱 **Последние сообщения WhatsApp**

`;const E={};return b.forEach(A=>{const $=A.guest_name||A.phone_number;E[$]||(E[$]=[]),E[$].push(A)}),Object.keys(E).forEach(A=>{Object.keys(E).length>1&&(k+=`### ${A}

`),E[A].sort((O,P)=>new Date(O.created_at).getTime()-new Date(P.created_at).getTime()).forEach(O=>{const P=new Date(O.created_at),U=`${P.toLocaleDateString("ru-RU")} ${P.toLocaleTimeString("ru-RU")}`,G=O.is_incoming?"📥":"📤",I=!O.is_read&&O.is_incoming?" (Непрочитано)":"";k+=`${G} **${U}**${I}:
${O.content}

`})}),k},g=async b=>{try{console.log("Начало создания задачи:",b),r(!0);const _={user_query:`Создай задачу: ${b.title}`,bot_response:"Создаю задачу...",isLoading:!0};e(P=>[...P,_]);const{data:{session:k}}=await X.auth.getSession(),E=k==null?void 0:k.access_token;console.log("Подготовка запроса к Edge Function task-manager");const A={"Content-Type":"application/json"};E?(console.log("Добавляем токен авторизации в запрос"),A.Authorization=`Bearer ${E}`):console.log("Токен авторизации не найден, выполняем запрос анонимно");const $=await fetch("https://fwchkusgryebslnjkoly.supabase.co/functions/v1/task-manager",{method:"POST",headers:A,body:JSON.stringify({action:"create",task:{title:b.title,description:b.description,priority:b.priority||"medium",house_number:b.houseNumber||"1"}})});if(console.log("Получен ответ от Edge Function, статус:",$.status),!$.ok){const P=await $.text();throw console.error(`Ошибка при создании задачи: ${$.status}`,P),new Error(`Ошибка при создании задачи: ${$.status} - ${P}`)}const O=await $.json();console.log("Результат создания задачи:",O),e(P=>P.map(U=>{var G;return U.isLoading?{...U,isLoading:!1,bot_response:`✅ Задача "${b.title}" успешно создана!${(G=O.task)!=null&&G.id?` ID: ${O.task.id}`:""}${O.employee?`, назначена на: ${O.employee}`:""}`}:U}))}catch(_){console.error("Ошибка при создании задачи:",_),e(k=>k.map(E=>E.isLoading?{...E,isLoading:!1,bot_response:`❌ Не удалось создать задачу: ${_.message}`}:E))}finally{r(!1)}},y=async(b,_)=>{try{r(!0);const k={user_query:`Отправь WhatsApp на ${b}: ${_}`,bot_response:"Отправляю сообщение...",isLoading:!0};e($=>[...$,k]);const E=await fetch("https://fwchkusgryebslnjkoly.supabase.co/functions/v1/whatsapp-sender",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:b,message:_})});if(!E.ok)throw new Error(`Ошибка при отправке WhatsApp: ${E.status}`);const A=await E.json();e($=>$.map(O=>O.isLoading?{...O,isLoading:!1,bot_response:`✅ Сообщение WhatsApp успешно отправлено на номер ${b}`}:O))}catch(k){console.error("Ошибка при отправке WhatsApp:",k),e(E=>E.map(A=>A.isLoading?{...A,isLoading:!1,bot_response:`❌ Не удалось отправить WhatsApp: ${k.message}`}:A))}finally{r(!1)}},S=async(b,_)=>{try{r(!0);let k=b==="create"?"Создаю":b==="update"?"Обновляю":"Удаляю";const E={user_query:`${k} бронирование: ${_.guest_name||"Гость"}, даты: ${_.start_date||"не указано"} - ${_.end_date||"не указано"}`,bot_response:`${k} бронирование...`,isLoading:!0};e(P=>[...P,E]);const A=await fetch("https://fwchkusgryebslnjkoly.supabase.co/functions/v1/booking-manager",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:b,booking:_,bookingId:_.id})});if(!A.ok)throw new Error(`Ошибка при работе с бронированием: ${A.status}`);const $=await A.json(),O={create:`✅ Бронирование для ${_.guest_name} успешно создано!`,update:`✅ Бронирование для ${_.guest_name} успешно обновлено!`,delete:`✅ Бронирование для ${_.guest_name} успешно отменено!`};e(P=>P.map(U=>U.isLoading?{...U,isLoading:!1,bot_response:O[b]}:U))}catch(k){console.error("Ошибка при работе с бронированием:",k),e(E=>E.map(A=>A.isLoading?{...A,isLoading:!1,bot_response:`❌ Не удалось выполнить операцию с бронированием: ${k.message}`}:A))}finally{r(!1)}};return{messages:n,isLoading:t,userInput:s,setUserInput:o,loadChatHistory:i,handleSendMessage:a,handleSendMessageText:l,createTask:g,sendWhatsAppMessage:y,manageBooking:S,getWhatsAppMessages:f}},Ku=(n={})=>{const{offsetTop:e=-600,offsetLeft:t=-450,embedded:r=!1}=n,s=C.useRef(null),[o,i]=C.useState({top:0,left:0}),a=()=>{if(s.current){const l=s.current.getBoundingClientRect();if(r){const c=window.innerHeight,u=window.innerWidth;i({top:c/2-300,left:u/2-210})}else i({top:l.top+e,left:l.left+t})}};return C.useEffect(()=>(window.addEventListener("resize",a),a(),()=>window.removeEventListener("resize",a)),[r,e,t]),{triggerRef:s,dialogPosition:o,updatePosition:a}};function Wt(){return Wt=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Wt.apply(null,arguments)}function Yu(n){const e=new Uint8Array(n);return window.btoa(String.fromCharCode(...e))}function Xu(n){const e=window.atob(n),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return r.buffer}const Mr=new Map;function fo(n,e){return async t=>{const r=Mr.get(n);if(r)return t.addModule(r);const s=new Blob([e],{type:"application/javascript"}),o=URL.createObjectURL(s);try{return await t.addModule(o),void Mr.set(n,o)}catch{URL.revokeObjectURL(o)}try{const i=`data:application/javascript;base64,${btoa(e)}`;await t.addModule(i),Mr.set(n,i)}catch{throw new Error(`Failed to load the ${n} worklet module. Make sure the browser supports AudioWorklets.`)}}}const Zu=fo("raw-audio-processor",`
const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("raw-audio-processor", RawAudioProcessor);
`);function po(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}class Ur{static async create({sampleRate:e,format:t,preferHeadphonesForIosDevices:r}){let s=null,o=null;try{const l={sampleRate:{ideal:e},echoCancellation:{ideal:!0},noiseSuppression:{ideal:!0}};if(po()&&r){const f=(await window.navigator.mediaDevices.enumerateDevices()).find(v=>v.kind==="audioinput"&&["airpod","headphone","earphone"].find(g=>v.label.toLowerCase().includes(g)));f&&(l.deviceId={ideal:f.deviceId})}const c=navigator.mediaDevices.getSupportedConstraints().sampleRate;s=new window.AudioContext(c?{sampleRate:e}:{});const u=s.createAnalyser();c||await s.audioWorklet.addModule("https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js"),await Zu(s.audioWorklet),o=await navigator.mediaDevices.getUserMedia({audio:l});const h=s.createMediaStreamSource(o),d=new AudioWorkletNode(s,"raw-audio-processor");return d.port.postMessage({type:"setFormat",format:t,sampleRate:e}),h.connect(u),u.connect(d),await s.resume(),new Ur(s,u,d,o)}catch(l){var i,a;throw(i=o)==null||i.getTracks().forEach(c=>c.stop()),(a=s)==null||a.close(),l}}constructor(e,t,r,s){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.context=e,this.analyser=t,this.worklet=r,this.inputStream=s}async close(){this.inputStream.getTracks().forEach(e=>e.stop()),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}}const Qu=fo("audio-concat-processor",`
const decodeTable = [0,132,396,924,1980,4092,8316,16764];

export function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audio-concat-processor", AudioConcatProcessor);
`);class zr{static async create({sampleRate:e,format:t}){let r=null;try{r=new AudioContext({sampleRate:e});const o=r.createAnalyser(),i=r.createGain();i.connect(o),o.connect(r.destination),await Qu(r.audioWorklet);const a=new AudioWorkletNode(r,"audio-concat-processor");return a.port.postMessage({type:"setFormat",format:t}),a.connect(i),await r.resume(),new zr(r,o,i,a)}catch(o){var s;throw(s=r)==null||s.close(),o}}constructor(e,t,r,s){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.context=e,this.analyser=t,this.gain=r,this.worklet=s}async close(){await this.context.close()}}function go(n){return!!n.type}class Fr{static async create(e){let t=null;try{var r;const o=(r=e.origin)!=null?r:"wss://api.elevenlabs.io",i=e.signedUrl?e.signedUrl:o+"/v1/convai/conversation?agent_id="+e.agentId,a=["convai"];e.authorization&&a.push(`bearer.${e.authorization}`),t=new WebSocket(i,a);const l=await new Promise((v,g)=>{t.addEventListener("open",()=>{var y;const S={type:"conversation_initiation_client_data"};var b,_,k,E;e.overrides&&(S.conversation_config_override={agent:{prompt:(b=e.overrides.agent)==null?void 0:b.prompt,first_message:(_=e.overrides.agent)==null?void 0:_.firstMessage,language:(k=e.overrides.agent)==null?void 0:k.language},tts:{voice_id:(E=e.overrides.tts)==null?void 0:E.voiceId}}),e.customLlmExtraBody&&(S.custom_llm_extra_body=e.customLlmExtraBody),e.dynamicVariables&&(S.dynamic_variables=e.dynamicVariables),(y=t)==null||y.send(JSON.stringify(S))},{once:!0}),t.addEventListener("error",y=>{setTimeout(()=>g(y),0)}),t.addEventListener("close",g),t.addEventListener("message",y=>{const S=JSON.parse(y.data);go(S)&&(S.type==="conversation_initiation_metadata"?v(S.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:c,agent_output_audio_format:u,user_input_audio_format:h}=l,d=mo(h??"pcm_16000"),f=mo(u);return new Fr(t,c,d,f)}catch(o){var s;throw(s=t)==null||s.close(),o}}constructor(e,t,r,s){this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.socket=e,this.conversationId=t,this.inputFormat=r,this.outputFormat=s,this.socket.addEventListener("error",o=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:o}),0)}),this.socket.addEventListener("close",o=>{this.disconnect(o.code===1e3?{reason:"agent",context:o}:{reason:"error",message:o.reason||"The connection was closed by the server.",context:o})}),this.socket.addEventListener("message",o=>{try{const i=JSON.parse(o.data);if(!go(i))return;this.onMessageCallback?this.onMessageCallback(i):this.queue.push(i)}catch{}})}close(){this.socket.close()}sendMessage(e){this.socket.send(JSON.stringify(e))}onMessage(e){this.onMessageCallback=e,this.queue.forEach(e),this.queue=[]}onDisconnect(e){this.onDisconnectCallback=e,this.disconnectionDetails&&e(this.disconnectionDetails)}disconnect(e){var t;this.disconnectionDetails||(this.disconnectionDetails=e,(t=this.onDisconnectCallback)==null||t.call(this,e))}}function mo(n){const[e,t]=n.split("_");if(!["pcm","ulaw"].includes(e))throw new Error(`Invalid format: ${n}`);const r=parseInt(t);if(isNaN(r))throw new Error(`Invalid sample rate: ${t}`);return{format:e,sampleRate:r}}const ed={clientTools:{}},td={onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{}};class Br{static async startSession(e){var t;const r=Wt({},ed,td,e);r.onStatusChange({status:"connecting"}),r.onCanSendFeedbackChange({canSendFeedback:!1});let s=null,o=null,i=null,a=null,l=null;if((t=e.useWakeLock)==null||t)try{l=await navigator.wakeLock.request("screen")}catch{}try{var c,u;a=await navigator.mediaDevices.getUserMedia({audio:!0});const b=(c=e.connectionDelay)!=null?c:{default:0,android:3e3};let _=b.default;var h;if(/android/i.test(navigator.userAgent))_=(h=b.android)!=null?h:_;else if(po()){var d;_=(d=b.ios)!=null?d:_}return _>0&&await new Promise(k=>setTimeout(k,_)),o=await Fr.create(e),[s,i]=await Promise.all([Ur.create(Wt({},o.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices})),zr.create(o.outputFormat)]),(u=a)==null||u.getTracks().forEach(k=>k.stop()),a=null,new Br(r,o,s,i,l)}catch(b){var f,v,g,y;r.onStatusChange({status:"disconnected"}),(f=a)==null||f.getTracks().forEach(_=>_.stop()),(v=o)==null||v.close(),await((g=s)==null?void 0:g.close()),await((y=i)==null?void 0:y.close());try{var S;await((S=l)==null?void 0:S.release()),l=null}catch{}throw b}}constructor(e,t,r,s,o){var i=this;this.options=void 0,this.connection=void 0,this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=1,this.canSendFeedback=!1,this.endSession=()=>this.endSessionWithDetails({reason:"user"}),this.endSessionWithDetails=async function(a){if(i.status==="connected"||i.status==="connecting"){i.updateStatus("disconnecting");try{var l;await((l=i.wakeLock)==null?void 0:l.release()),i.wakeLock=null}catch{}i.connection.close(),await i.input.close(),await i.output.close(),i.updateStatus("disconnected"),i.options.onDisconnect(a)}},this.updateMode=a=>{a!==this.mode&&(this.mode=a,this.options.onModeChange({mode:a}))},this.updateStatus=a=>{a!==this.status&&(this.status=a,this.options.onStatusChange({status:a}))},this.updateCanSendFeedback=()=>{const a=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==a&&(this.canSendFeedback=a,this.options.onCanSendFeedbackChange({canSendFeedback:a}))},this.onMessage=async function(a){switch(a.type){case"interruption":return a.interruption_event&&(i.lastInterruptTimestamp=a.interruption_event.event_id),void i.fadeOutAudio();case"agent_response":return void i.options.onMessage({source:"ai",message:a.agent_response_event.agent_response});case"user_transcript":return void i.options.onMessage({source:"user",message:a.user_transcription_event.user_transcript});case"internal_tentative_agent_response":return void i.options.onDebug({type:"tentative_agent_response",response:a.tentative_agent_response_internal_event.tentative_agent_response});case"client_tool_call":if(i.options.clientTools.hasOwnProperty(a.client_tool_call.tool_name))try{var l;const c=(l=await i.options.clientTools[a.client_tool_call.tool_name](a.client_tool_call.parameters))!=null?l:"Client tool execution successful.",u=typeof c=="object"?JSON.stringify(c):String(c);i.connection.sendMessage({type:"client_tool_result",tool_call_id:a.client_tool_call.tool_call_id,result:u,is_error:!1})}catch(c){i.onError("Client tool execution failed with following error: "+(c==null?void 0:c.message),{clientToolName:a.client_tool_call.tool_name}),i.connection.sendMessage({type:"client_tool_result",tool_call_id:a.client_tool_call.tool_call_id,result:"Client tool execution failed: "+(c==null?void 0:c.message),is_error:!0})}else{if(i.options.onUnhandledClientToolCall)return void i.options.onUnhandledClientToolCall(a.client_tool_call);i.onError(`Client tool with name ${a.client_tool_call.tool_name} is not defined on client`,{clientToolName:a.client_tool_call.tool_name}),i.connection.sendMessage({type:"client_tool_result",tool_call_id:a.client_tool_call.tool_call_id,result:`Client tool with name ${a.client_tool_call.tool_name} is not defined on client`,is_error:!0})}return;case"audio":return void(i.lastInterruptTimestamp<=a.audio_event.event_id&&(i.options.onAudio(a.audio_event.audio_base_64),i.addAudioBase64Chunk(a.audio_event.audio_base_64),i.currentEventId=a.audio_event.event_id,i.updateCanSendFeedback(),i.updateMode("speaking")));case"ping":return void i.connection.sendMessage({type:"pong",event_id:a.ping_event.event_id});default:return void i.options.onDebug(a)}},this.onInputWorkletMessage=a=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:Yu(a.data[0].buffer)})},this.onOutputWorkletMessage=({data:a})=>{a.type==="process"&&this.updateMode(a.finished?"listening":"speaking")},this.addAudioBase64Chunk=a=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:Xu(a)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.onError=(a,l)=>{console.error(a,l),this.options.onError(a,l)},this.calculateVolume=a=>{if(a.length===0)return 0;let l=0;for(let c=0;c<a.length;c++)l+=a[c]/255;return l/=a.length,l<0?0:l>1?1:l},this.getId=()=>this.connection.conversationId,this.isOpen=()=>this.status==="connected",this.setVolume=({volume:a})=>{this.volume=a},this.setMicMuted=a=>{this.input.setMuted(a)},this.getInputByteFrequencyData=()=>(this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData),this.getOutputByteFrequencyData=()=>(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData),this.getInputVolume=()=>this.calculateVolume(this.getInputByteFrequencyData()),this.getOutputVolume=()=>this.calculateVolume(this.getOutputByteFrequencyData()),this.sendFeedback=a=>{this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:a?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")},this.sendContextualUpdate=a=>{this.connection.sendMessage({type:"contextual_update",text:a})},this.sendUserMessage=a=>{this.connection.sendMessage({type:"user_message",text:a})},this.sendUserActivity=()=>{this.connection.sendMessage({type:"user_activity"})},this.options=e,this.connection=t,this.input=r,this.output=s,this.wakeLock=o,this.options.onConnect({conversationId:t.conversationId}),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onMessage(this.onMessage),this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage,this.updateStatus("connected")}}function qr(){return qr=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},qr.apply(null,arguments)}const rd=["micMuted","volume"];function nd(n={}){const{micMuted:e,volume:t}=n,r=function(d,f){if(d==null)return{};var v={};for(var g in d)if({}.hasOwnProperty.call(d,g)){if(f.includes(g))continue;v[g]=d[g]}return v}(n,rd),s=C.useRef(null),o=C.useRef(null),[i,a]=C.useState("disconnected"),[l,c]=C.useState(!1),[u,h]=C.useState("listening");return C.useEffect(()=>{var d;e!==void 0&&(s==null||(d=s.current)==null||d.setMicMuted(e))},[e]),C.useEffect(()=>{var d;t!==void 0&&(s==null||(d=s.current)==null||d.setVolume({volume:t}))},[t]),C.useEffect(()=>()=>{var d;(d=s.current)==null||d.endSession()},[]),{startSession:async d=>{var f;if((f=s.current)!=null&&f.isOpen())return s.current.getId();if(o.current)return(await o.current).getId();try{return o.current=Br.startSession(qr({},r??{},d??{},{onModeChange:({mode:v})=>{h(v)},onStatusChange:({status:v})=>{a(v)},onCanSendFeedbackChange:({canSendFeedback:v})=>{c(v)}})),s.current=await o.current,e!==void 0&&s.current.setMicMuted(e),t!==void 0&&s.current.setVolume({volume:t}),s.current.getId()}finally{o.current=null}},endSession:async()=>{const d=s.current;s.current=null,await(d==null?void 0:d.endSession())},setVolume:({volume:d})=>{var f;(f=s.current)==null||f.setVolume({volume:d})},getInputByteFrequencyData:()=>{var d;return(d=s.current)==null?void 0:d.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var d;return(d=s.current)==null?void 0:d.getOutputByteFrequencyData()},getInputVolume:()=>{var d,f;return(d=(f=s.current)==null?void 0:f.getInputVolume())!=null?d:0},getOutputVolume:()=>{var d,f;return(d=(f=s.current)==null?void 0:f.getOutputVolume())!=null?d:0},sendFeedback:d=>{var f;(f=s.current)==null||f.sendFeedback(d)},getId:()=>{var d;return(d=s.current)==null?void 0:d.getId()},sendContextualUpdate:d=>{var f;(f=s.current)==null||f.sendContextualUpdate(d)},sendUserMessage:d=>{var f;(f=s.current)==null||f.sendUserMessage(d)},sendUserActivity:()=>{var d;(d=s.current)==null||d.sendUserActivity()},status:i,canSendFeedback:l,micMuted:e,isSpeaking:u==="speaking"}}const sd=({embeddedMode:n=!1})=>{const[e,t]=C.useState(!1),[r,s]=C.useState(!1),[o,i]=C.useState(!1),[a,l]=C.useState(!1),[c,u]=C.useState(0),[h,d]=C.useState("");C.useRef(!1);const f=w=>{let x=w.replace(/\D/g,"");return x.startsWith("8")&&x.length===11&&(x="7"+x.substring(1)),x.length===10&&(x="7"+x),console.log(`Отформатированный номер телефона: ${x}`),x},v=async(w,x)=>{try{let R="";const{data:q}=await X.from("bookings").select("guest_name").eq("guest_phone",w).order("created_at",{ascending:!1}).limit(1);q&&q.length>0&&(R=q[0].guest_name);let M=`Здравствуйте${R?", "+R:""}!`;return x?x.toLowerCase().includes("музык")?M+=" Пожалуйста, выключите музыку. Спасибо за понимание.":x.toLowerCase().includes("шум")?M+=" Пожалуйста, соблюдайте тишину. Спасибо за понимание.":x.toLowerCase().includes("уборк")?M+=" Сообщаем, что скоро будет проведена уборка в вашем номере.":x.toLowerCase().includes("выезд")||x.toLowerCase().includes("выселени")?M+=" Напоминаем о выезде до 12:00. Если нужно продлить проживание, сообщите администратору.":M+=" Как мы можем вам помочь?":M+=" Как мы можем вам помочь?",M}catch(R){return console.error("Ошибка при генерации текста сообщения:",R),"Здравствуйте! Как мы можем вам помочь?"}},{triggerRef:g,dialogPosition:y}=Ku({offsetTop:-600,offsetLeft:-450,embedded:n}),{messages:S,isLoading:b,userInput:_,setUserInput:k,loadChatHistory:E,handleSendMessage:A,handleSendMessageText:$,sendWhatsAppMessage:O,createTask:P,manageBooking:U,getWhatsAppMessages:G}=Ju(),I=nd({onConnect:()=>{console.log("Используется Agent ID:",process.env.NEXT_PUBLIC_AGENT_ID||"bk6zd2EX7Rc7o9LnxEtY"),console.log("ElevenLabs conversation connected"),i(!0),J.success("Голосовой ассистент активирован")},onDisconnect:()=>{console.log("ElevenLabs conversation disconnected"),i(!1),l(!1)},onMessage:w=>{var x,R;w.type==="transcription"&&((x=w.transcription)!=null&&x.is_final)?(console.log("Распознанная речь:",w.transcription.text),d(w.transcription.text)):w.type==="generation"&&((R=w.generation)!=null&&R.text)?(console.log("Ответ ассистента:",w.generation.text),l(!0)):w.type==="debug"&&console.log("ElevenLabs debug message:",w.debug)},onError:w=>{console.error("Ошибка ElevenLabs:",w),J.error(`Ошибка голосового ассистента: ${w.message||"Неизвестная ошибка"}`),i(!1),l(!1)},clientTools:{createTask:async w=>{if(!P)return console.error("createTask function is not available"),"Error: Task creation function is not available";try{return await P({title:w.title,description:w.description,priority:w.priority,houseNumber:w.houseNumber}),"Задача успешно создана"}catch(x){return console.error("Error creating task:",x),`Ошибка при создании задачи: ${x.message}`}},getBookings:async w=>{try{console.log("Вызван метод getBookings с параметрами:",w);let x=X.from("bookings").select("*");w.guestName&&(x=x.ilike("guest_name",`%${w.guestName}%`)),w.status&&(x=x.eq("status",w.status)),w.startDate&&(x=x.gte("start_date",w.startDate)),w.endDate&&(x=x.lte("end_date",w.endDate)),x=x.order("created_at",{ascending:!1}).limit(w.limit||10);const{data:R,error:q}=await x;if(q)throw console.error("Ошибка при получении данных бронирований:",q),q;return console.log(`Найдено ${(R==null?void 0:R.length)||0} бронирований`),{success:!0,data:R||[],message:`Найдено ${(R==null?void 0:R.length)||0} бронирований`}}catch(x){return console.error("Ошибка при получении бронирований:",x),{success:!1,data:[],message:`Ошибка при получении бронирований: ${x.message||"Неизвестная ошибка"}`}}},getWhatsAppMessages:async w=>{try{console.log("Вызван метод getWhatsAppMessages с параметрами:",w);let x=X.from("whatsapp_messages").select("*");if(w.phone){const M=w.phone.replace(/\D/g,"");M.length>0&&(x=x.ilike("phone_number",`%${M}%`))}w.guestName&&(x=x.ilike("guest_name",`%${w.guestName}%`)),w.showUnread&&(x=x.eq("is_read",!1)),w.startDate&&(x=x.gte("created_at",w.startDate)),w.endDate&&(x=x.lte("created_at",w.endDate)),x=x.order("created_at",{ascending:!1}).limit(w.limit||10);const{data:R,error:q}=await x;if(q)throw console.error("Ошибка при получении сообщений WhatsApp:",q),q;return console.log(`Найдено ${(R==null?void 0:R.length)||0} сообщений WhatsApp`),{success:!0,data:R||[],message:`Найдено ${(R==null?void 0:R.length)||0} сообщений WhatsApp`}}catch(x){return console.error("Ошибка при получении сообщений WhatsApp:",x),{success:!1,data:[],message:`Ошибка при получении сообщений WhatsApp: ${x.message||"Неизвестная ошибка"}`}}},getTasks:async w=>{try{console.log("Вызван метод getTasks с параметрами:",w);let x=X.from("tasks").select(`
              *,
              employees (
                name,
                position
              )
            `);w.status&&(x=x.eq("status",w.status)),w.priority&&(x=x.eq("priority",w.priority)),w.houseNumber&&(x=x.eq("house_number",w.houseNumber)),w.startDate&&(x=x.gte("created_at",w.startDate)),w.endDate&&(x=x.lte("created_at",w.endDate)),x=x.order("created_at",{ascending:!1}).limit(w.limit||10);const{data:R,error:q}=await x;if(q)throw console.error("Ошибка при получении задач:",q),q;let M=R||[];return w.employeeName&&M.length>0&&(M=M.filter(K=>{var Z,vo;return(vo=K.employees)==null?void 0:vo.name.toLowerCase().includes(((Z=w.employeeName)==null?void 0:Z.toLowerCase())||"")})),console.log(`Найдено ${M.length} задач`),{success:!0,data:M,message:`Найдено ${M.length} задач`}}catch(x){return console.error("Ошибка при получении задач:",x),{success:!1,data:[],message:`Ошибка при получении задач: ${x.message||"Неизвестная ошибка"}`}}},cancelBooking:async w=>{try{if(console.log("Вызван метод cancelBooking с параметрами:",w),!w.id&&!w.guestName)throw new Error("Необходимо указать ID бронирования или имя гостя");let x=X.from("bookings").select("*");w.id?x=x.eq("id",w.id):w.guestName&&(x=x.ilike("guest_name",`%${w.guestName}%`));const{data:R,error:q}=await x.order("created_at",{ascending:!1}).limit(1);if(q)throw console.error("Ошибка при поиске бронирования:",q),q;if(!R||R.length===0)return console.log("Бронирование не найдено"),{success:!1,message:"Бронирование не найдено"};console.log("Найдено бронирование для отмены:",R[0]);const{data:M,error:K}=await X.from("bookings").update({status:"cancelled"}).eq("id",R[0].id).select();if(K)throw console.error("Ошибка при отмене бронирования:",K),K;return console.log("Бронирование успешно отменено:",M),{success:!0,data:R[0],message:`Бронирование для ${R[0].guest_name} успешно отменено`}}catch(x){return console.error("Ошибка при отмене бронирования:",x),{success:!1,message:`Ошибка при отмене бронирования: ${x.message||"Неизвестная ошибка"}`}}},createBooking:async w=>{try{if(console.log("Вызван метод createBooking с параметрами:",w),!w.room_number||!w.guest_name||!w.guest_phone||!w.start_date||!w.end_date){const Z="Для создания бронирования необходимы: номер комнаты, имя гостя, телефон, даты заезда и выезда";return console.error(Z),J.error(Z),{success:!1,message:Z}}const x=f(w.guest_phone),R=await fetch("https://fwchkusgryebslnjkoly.supabase.co/functions/v1/booking-manager",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"check-availability",booking:{room_number:w.room_number,start_date:w.start_date,end_date:w.end_date}})});if(!R.ok){const Z=await R.text();throw J.error(`Ошибка при проверке доступности: ${R.status}`),new Error(`Ошибка при проверке доступности: ${Z}`)}if(!(await R.json()).available){const Z=`Номер ${w.room_number} недоступен на указанные даты`;return J.error(Z),{success:!1,message:Z}}const M=await fetch("https://fwchkusgryebslnjkoly.supabase.co/functions/v1/booking-manager",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"create",booking:{room_number:w.room_number,start_date:w.start_date,end_date:w.end_date,guest_name:w.guest_name,guest_phone:x,price:w.price||null,prepayment:w.prepayment||0,comment:w.comment||"",source:"elevenlabs"}})});if(!M.ok){const Z=await M.text();throw J.error(`Ошибка при создании бронирования: ${M.status}`),new Error(`Ошибка API бронирования: ${M.status} - ${Z}`)}const K=await M.json();if(console.log("Результат создания бронирования:",K),K.success){J.success(`Бронирование для ${w.guest_name} успешно создано!`);try{const Z=`Здравствуйте, ${w.guest_name}! Ваше бронирование номера ${w.room_number} на даты ${w.start_date} - ${w.end_date} успешно создано. Спасибо, что выбрали наш отель!`;await O(x,Z)}catch(Z){console.error("Ошибка при отправке уведомления:",Z)}}return{success:!0,booking:K.booking,message:`Бронирование для ${w.guest_name} успешно создано!`}}catch(x){return console.error("Ошибка при создании бронирования:",x),J.error(`Ошибка при создании бронирования: ${x.message||"Неизвестная ошибка"}`),{success:!1,message:`Ошибка при создании бронирования: ${x.message||"Неизвестная ошибка"}`}}},sendWhatsAppMessage:async w=>{try{if(console.log("Вызван метод sendWhatsAppMessage с параметрами:",w),!w.phone){const M="Номер телефона обязателен для заполнения";return console.error(M),J.error(M),{success:!1,message:M}}const x=f(w.phone);if(console.log("Номер после форматирования:",x),x.length<10){const M="Некорректный формат номера телефона";return console.error(M,{original:w.phone,cleaned:x}),J.error(M),{success:!1,message:M,details:{original:w.phone,cleaned:x}}}let R=w.message;return R||(console.log("Сообщение не указано, генерируем автоматически"),R=await v(x,w.context),console.log("Сгенерированное сообщение:",R)),await O(x,R)}catch(x){return console.error("Ошибка при отправке WhatsApp сообщения:",x),J.error(`Ошибка при отправке сообщения: ${x.message||"Неизвестная ошибка"}`),{success:!1,message:`Ошибка при отправке сообщения: ${x.message||"Неизвестная ошибка"}`}}}}});C.useEffect(()=>{l(I.isSpeaking)},[I.isSpeaking]),C.useEffect(()=>{if(I.isSpeaking){const w=setInterval(()=>{u(Math.floor(Math.random()*7)+3)},150);return()=>clearInterval(w)}else u(0)},[I.isSpeaking]);const ht=async()=>{try{if(I.status==="connected")console.log("Ending ElevenLabs conversation"),await I.endSession(),i(!1),l(!1),J.info("Голосовой ассистент деактивирован");else{console.log("Starting ElevenLabs conversation");const w=process.env.NEXT_PUBLIC_AGENT_ID||"bk6zd2EX7Rc7o9LnxEtY";console.log("Используется Agent ID:",w),await I.startSession({agentId:w}),J.success("Голосовой ассистент активирован")}}catch(w){console.error("Error toggling ElevenLabs conversation:",w),J.error(`Ошибка активации ассистента: ${w.message||"Неизвестная ошибка"}`)}};C.useEffect(()=>{e&&E()},[e,E]),C.useEffect(()=>{if(n){const w=setTimeout(()=>{t(!0),E()},500);return()=>clearTimeout(w)}},[n,E]);const Qe=w=>{t(w),w?w&&n&&setTimeout(()=>{!o&&I.status!=="connected"&&ht()},1e3):(s(!1),I.status==="connected"&&I.endSession())},Ht=()=>{s(!r)};return m.jsxs(m.Fragment,{children:[m.jsxs(Ga,{open:e,onOpenChange:Qe,children:[n?null:m.jsx(Ja,{asChild:!0,children:m.jsx(rs,{ref:g})}),m.jsx(Dl,{isExpanded:r,toggleFullscreen:Ht,dialogPosition:y,isListening:o,isSpeaking:a,voiceVolume:c,transcript:h,onCircleClick:ht,userInput:_,onUserInputChange:w=>k(w.target.value),onSendMessage:A,messages:S,isLoading:b,createTask:P})]}),n&&m.jsx("div",{style:{position:"fixed",bottom:"-100px",right:"-100px",visibility:"hidden"},children:m.jsx("button",{ref:g,children:"Hidden Trigger"})})]})};class od extends HTMLElement{constructor(){super();F(this,"shadow");F(this,"container");F(this,"root",null);this.shadow=this.attachShadow({mode:"open"}),this.container=document.createElement("div"),this.container.setAttribute("class","voice-assistant-container"),this.shadow.appendChild(this.container);const t=document.createElement("style");t.textContent=`
      .voice-assistant-container {
        position: relative;
        z-index: 9999;
      }
      
      /* Import fonts and base styles */
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    `,this.shadow.appendChild(t)}connectedCallback(){const t=this.getAttribute("agent-id")||"bk6zd2EX7Rc7o9LnxEtY",r=document.createElement("link");r.setAttribute("rel","stylesheet"),r.setAttribute("href","https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"),this.shadow.appendChild(r);const s=document.createElement("link");s.setAttribute("rel","stylesheet"),s.setAttribute("href","https://elevenlabs.io/convai-widget/styles.css"),this.shadow.appendChild(s),window.env={...window.env,NEXT_PUBLIC_AGENT_ID:t};try{this.root=Gr(this.container),this.root.render(m.jsx(C.StrictMode,{children:m.jsx(sd,{embeddedMode:!0})}))}catch(o){console.error("Error rendering voice assistant:",o)}}disconnectedCallback(){this.root&&(this.root.unmount(),this.root=null)}}customElements.define("voice-assistant",od),console.log("Voice Assistant Widget initialized");const id="voice-assistant";var ad=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")};const ld=Object.freeze(Object.defineProperty({__proto__:null,default:xo(ad)},Symbol.toStringTag,{value:"Module"}));return id});
//# sourceMappingURL=voice-assistant-widget.umd.js.map
